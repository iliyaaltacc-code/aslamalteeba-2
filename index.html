
  <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aslama Alteeba â€” Tire Shop</title>
  <script>
    document.documentElement.classList.add("js-page-transition");
  </script>
  <meta name="description" content="Aslama Alteeba: premium tire supplier in the UAE. Browse Duraturn, Bridgestone, Firemax. Quality, heritage, and reliability." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles/timeline.css">
  <link rel="stylesheet" href="/styles/smoothness.css">
  <link rel="stylesheet" href="/styles/favorites.css">
  <link rel="stylesheet" href="/styles/motion.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
  <script src="/customerMemory.js"></script>
  <script src="/favorites.js"></script>
  <script src="/data/products.js"></script>
  <script src="/compareState.js"></script>
  <script defer src="/transition.js"></script>
  <script defer src="/motion.js"></script>
  <style>
    html,body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
    .glass{backdrop-filter: blur(12px); background: rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1)}
    .brand-gradient{background:linear-gradient(135deg,#00E0A4,#32D5FF)}
    .shine{position:relative;overflow:hidden}
    .shine:after{content:"";position:absolute;inset:-120% auto auto -120%;width:60%;height:300%;transform:rotate(25deg);background:linear-gradient(90deg,transparent,rgba(255,255,255,.18),transparent);animation:shine 6s infinite}
    [x-cloak]{display:none !important}
    @keyframes shine{0%{left:-120%}60%{left:140%}100%{left:140%}}
    
    /* Rank badge and verdict animation */
    @keyframes fadeInScale {
      0% {
        opacity: 0;
        transform: scale(0.8);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    /* Slider styling */
    .slider::-webkit-slider-thumb {
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: linear-gradient(135deg,#00E0A4,#32D5FF);
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,224,164,0.4);
    }
    .slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: linear-gradient(135deg,#00E0A4,#32D5FF);
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 8px rgba(0,224,164,0.4);
    }
  </style>
</head>
<body class="bg-neutral-950 text-neutral-100" x-data="appState()" x-init="init(); showWelcomeMessage()">
  <div id="page-transition" class="page-transition is-active" aria-hidden="true"></div>
  <!-- HEADER -->
  <header class="sticky top-0 z-50 glass">
    <div class="max-w-7xl mx-auto flex items-center px-4 py-3 gap-6">
      <h1 class="text-xl font-extrabold tracking-tight whitespace-nowrap">Aslama <span class="text-emerald-400">Alteeba</span></h1>
      <nav class="hidden md:flex gap-6 text-sm flex-wrap">
        <a href="#about" class="hover:text-white">About</a>
        <div class="relative" x-data="{open:false}">
          <button class="hover:text-white flex items-center gap-2" aria-haspopup="true" :aria-expanded="open" @click="open = !open" @keydown.escape="open=false">
            Products
            <span class="text-xs text-neutral-400">â–¾</span>
          </button>
          <div class="absolute left-0 top-full mt-2 w-72 rounded-2xl border border-white/10 bg-neutral-950/95 backdrop-blur p-2 shadow-xl" x-show="open" x-transition.origin.top.left @click.outside="open=false" x-cloak>
            <a href="#passenger-car-tires" class="block rounded-xl px-3 py-2 text-sm text-neutral-200 hover:bg-white/10" @click="open=false">Passenger Car Tires</a>
            <a href="#truck-bus-radial-tires" class="block rounded-xl px-3 py-2 text-sm text-neutral-200 hover:bg-white/10" @click="open=false">Truck And Bus Radial Tires</a>
            <a href="#otr-tires" class="block rounded-xl px-3 py-2 text-sm text-neutral-200 hover:bg-white/10" @click="open=false">OTR Tires</a>
            <a href="#truck-bus-bias-tires" class="block rounded-xl px-3 py-2 text-sm text-neutral-200 hover:bg-white/10" @click="open=false">Truck And Bus Bias Tires</a>
          </div>
        </div>
        <a href="#intro" class="hover:text-white">Introduction Email</a>
        <a href="#shop" class="hover:text-white">Browse</a>
        <a href="#contact" class="hover:text-white">Contact</a>
        <a href="#hq" class="hover:text-white">HQ</a>
        <a href="#imports" class="hover:text-white">Imports</a>
        <a href="#shipping" class="hover:text-white">Shipping</a>
        <a href="#brands" class="hover:text-white">Brands</a>
      </nav>
      <div class="flex items-center gap-2 ml-auto">
        <a href="/fa/" class="px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/15">
          ðŸ‡®ðŸ‡· Persian
        </a>
        <a href="/ar/" class="px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/15">
          ðŸ‡¦ðŸ‡ª Arabic
        </a>

        <a href="/favorites.html" class="favorite-nav-link w-10 h-10 rounded-full bg-white/10 border border-white/10 hover:bg-white/15 flex items-center justify-center" aria-label="View favorites">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M12 21s-7-4.35-9.33-8.4C.9 9.05 2.28 5.5 5.72 4.65A5.35 5.35 0 0 1 12 7.08a5.35 5.35 0 0 1 6.28-2.43c3.44.85 4.82 4.4 3.05 7.95C19 16.65 12 21 12 21z"/>
          </svg>
          <span class="favorite-badge" x-show="favoriteCount" x-text="favoriteCount"></span>
        </a>

        <!-- Profile Icon (always visible) -->
        <button id="profileIcon" onclick="handleProfileClick()" class="w-10 h-10 rounded-full bg-white/10 border border-white/10 hover:bg-white/15 flex items-center justify-center" title="Profile" aria-label="Go to profile or sign in">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <circle cx="12" cy="8" r="4"/>
            <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2"/>
          </svg>
        </button>

        <!-- Auth buttons (controlled by Firebase) -->
        <a href="/auth.html" id="authSignInBtn" class="px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/15" style="display: none;">
          Sign In / Sign Up
        </a>
        <button id="authSignOutBtn" class="px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/15" style="display: none;">
          Sign Out
        </button>

        <a href="tel:+971554637045" class="px-3 py-2 rounded-xl bg-emerald-500 text-black font-semibold hover:opacity-90">
          +971 55 463 7045
        </a>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section id="hero" class="max-w-7xl mx-auto px-4 py-12 grid md:grid-cols-2 gap-10 items-center">
    <div>
      <h2 class="text-5xl font-extrabold mb-4 leading-tight">Premium Tires.<br><span class="text-emerald-400">UAE Quality.</span></h2>
      <p class="text-lg text-neutral-300 mb-6">Aslama Alteeba delivers high-grade tires across the UAE. Partnerships with Duraturn, Bridgestone, and Firemax ensure safety, comfort, and reliability.</p>
      <a href="#shop" class="px-6 py-3 rounded-2xl brand-gradient text-black font-bold">Browse Tires</a>
    </div>
    <div>
      <img src="https://www.duraturntires.com/wp-content/uploads/tire-mozzo-touring-hero.png" class="rounded-2xl shadow-lg" alt="Tire showcase">
    </div>
  </section>

  <!-- ABOUT -->
  <section id="about" class="max-w-7xl mx-auto px-4 py-16">
    <h2 class="text-3xl font-bold mb-4">Our History</h2>
    <p class="text-neutral-300 leading-relaxed">Founded in Dubai in 2017, Aslama Alteeba began as a small supplier focused on bringing safe, affordable, and performance-driven tires to local markets. Over the years, we evolved into a trusted distributor, known for precision logistics and customer care.</p>
  </section>

  <!-- MATERIALS -->
  <section id="materials" class="max-w-7xl mx-auto px-4 py-16 bg-neutral-900/50 rounded-3xl">
    <h2 class="text-3xl font-bold mb-4">Products</h2>
    <p class="text-neutral-300 leading-relaxed mb-8">Explore the core product families we supply for private vehicles, long-haul fleets, and heavy-duty industrial use. Each range is curated for consistent performance, predictable wear, and dependable casing integrity across the conditions they are designed for.</p>
    <div class="space-y-32 md:space-y-44">
      <article id="passenger-car-tires" class="glass rounded-3xl p-6 border-white/10 scroll-mt-24">
        <h3 class="text-xl font-bold mb-3">Passenger Car Tires</h3>
        <p class="text-neutral-300 leading-relaxed">Passenger car tires are engineered for daily comfort, low noise, and safe braking at highway speeds. Our selection emphasizes optimized tread patterns for wet traction, balanced rolling resistance for fuel economy, and stable shoulder blocks for confident lane changes. Customers can choose touring-focused options for smooth rides or performance-oriented compounds for precise steering response, all backed by consistent uniformity standards that reduce vibration over long distances.</p>
        <div class="mt-6 space-y-4">
          <div class="max-w-md">
            <label class="text-sm font-semibold text-neutral-200">Passenger car tire brands</label>
            <select
              x-model="passengerBrandSelection"
              @change="activePassengerBrand = passengerBrandSelection"
              class="mt-2 w-full bg-white/5 border border-white/10 rounded-xl px-3 py-2"
            >
              <option value="">Select a brand to view models</option>
              <template x-for="b in passengerBrands" :key="b.name">
                <option :value="b.name" x-text="b.name"></option>
              </template>
            </select>
          </div>

          <div x-show="passengerBrandSelection" x-transition x-cloak class="glass rounded-2xl p-5 border-white/10">
            <div class="flex flex-wrap gap-2 mb-4">
              <template x-for="b in passengerBrands" :key="b.name">
                <button
                  class="px-3 py-2 rounded-xl text-sm border border-white/10"
                  :class="activePassengerBrand === b.name ? 'bg-emerald-400 text-black font-semibold' : 'bg-white/5 text-neutral-200 hover:bg-white/10'"
                  @click="activePassengerBrand = b.name; passengerBrandSelection = b.name"
                  x-text="b.name"
                ></button>
              </template>
            </div>

            <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4" x-show="passengerBrandModels(activePassengerBrand).length">
              <template x-for="m in passengerBrandModels(activePassengerBrand)" :key="m.name">
                <article class="rounded-2xl overflow-hidden bg-black/30 border border-white/10">
                  <img :src="m.img" :alt="m.name" class="w-full h-36 object-cover" />
                  <div class="p-3 space-y-1">
                    <h4 class="font-semibold" x-text="m.name"></h4>
                    <p class="text-xs text-neutral-400" x-text="m.desc"></p>
                  </div>
                </article>
              </template>
            </div>
            <p class="text-sm text-neutral-400" x-show="passengerBrandSelection && !passengerBrandModels(activePassengerBrand).length">
              Model lineup coming soon.
            </p>
          </div>
        </div>
      </article>
      <article id="truck-bus-radial-tires" class="glass rounded-3xl p-6 border-white/10 scroll-mt-24">
        <h3 class="text-xl font-bold mb-3">Truck And Bus Radial Tires</h3>
        <p class="text-neutral-300 leading-relaxed">Truck and bus radial tires are built to maximize mileage and load stability for commercial fleets. These casings use steel-belted radial construction to control heat, improve tread life, and support retreading cycles. We stock options for steer, drive, and trailer positions, with tread designs tailored for long-haul efficiency, regional durability, or urban stop-start traction. The result is predictable wear, reduced downtime, and improved cost-per-kilometer performance.</p>
      </article>
      <article id="otr-tires" class="glass rounded-3xl p-6 border-white/10 scroll-mt-24">
        <h3 class="text-xl font-bold mb-3">OTR Tires</h3>
        <p class="text-neutral-300 leading-relaxed">OTR (Off-the-Road) tires are specified for heavy machinery operating in quarries, construction sites, and mining environments. These tires prioritize cut resistance, deep lug depth, and robust sidewall protection to handle sharp debris and high torque loads. The product mix includes patterns for loaders, graders, and articulated dump trucks, with compounds tuned for heat management and traction on loose or rocky terrain. This ensures long service life under extreme working conditions.</p>
      </article>
      <article id="truck-bus-bias-tires" class="glass rounded-3xl p-6 border-white/10 scroll-mt-24">
        <h3 class="text-xl font-bold mb-3">Truck And Bus Bias Tires</h3>
        <p class="text-neutral-300 leading-relaxed">Truck and bus bias tires remain the preferred choice for certain regional routes, mixed surfaces, and low-speed heavy-load applications. Their cross-ply construction delivers strong sidewall rigidity and resistance to impacts, making them suitable for rugged sites and older fleets. We provide bias options with reinforced plies, durable compounds, and tread patterns designed for traction and stability on uneven roads, helping operators maintain reliable performance in demanding environments.</p>
      </article>
    </div>
  </section>

  <!-- HQ -->
  <section id="hq" class="max-w-7xl mx-auto px-4 py-16">
    <h2 class="text-3xl font-bold mb-4">Headquarters & Facilities</h2>
    <p class="text-neutral-300 leading-relaxed">Our Dubai HQ is the operational hub for logistics, import coordination, and partner management. With satellite facilities in Sharjah and Ras Al Khaimah, we ensure smooth inventory distribution and real-time container tracking.</p>
  </section>

  <!-- IMPORTS -->
  <section id="imports" class="max-w-7xl mx-auto px-4 py-16 bg-neutral-900/50 rounded-3xl">
    <h2 class="text-3xl font-bold mb-4">Global Imports</h2>
    <p class="text-neutral-300 leading-relaxed">We source from certified manufacturers across Japan, China, and Thailand, maintaining relationships with Duraturn, Bridgestone, and Firemax plants. Every shipment passes through customs-approved facilities, ensuring authenticity and traceability.</p>
  </section>

  <!-- SHIPPING -->
  <section id="shipping" class="max-w-7xl mx-auto px-4 py-16">
    <h2 class="text-3xl font-bold mb-4">Shipping & Installation</h2>
    <p class="text-neutral-300 leading-relaxed">Rapid delivery across all Emirates. Choose local pickup, on-site installation, or direct shipment for fleet clients. We collaborate with service centers to provide same-day fitting when possible.</p>
  </section>

  <!-- BRANDS -->
  <section id="brands" class="max-w-7xl mx-auto px-4 py-20 bg-neutral-900/40 rounded-3xl">
    <div class="flex items-end justify-between gap-4 mb-8">
      <div>
        <h2 class="text-3xl font-extrabold">Brands</h2>
        <p class="text-neutral-400">Browse our partner brands and send an inquiry instantly.</p>
      </div>
    </div>

    <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-5">
      <template x-for="b in brands" :key="b.name">
        <article class="glass rounded-3xl overflow-hidden border-white/10">
          <div class="bg-black/30 p-4 h-32 flex items-center justify-center">
            <img :src="b.img" :alt="b.name + ' logo'" class="max-h-24 object-contain" />
          </div>
          <div class="p-4 space-y-3">
            <div class="flex items-center justify-between gap-2">
              <h3 class="font-bold text-lg" x-text="b.name"></h3>
              <span class="text-xs px-2 py-1 rounded-full bg-white/10" x-text="brandProductCount(b.name) + ' products'"></span>
            </div>
            <p class="text-neutral-300 text-sm" x-text="b.desc"></p>
            <button class="w-full px-4 py-2 rounded-xl brand-gradient text-black font-bold hover:opacity-90" @click="sendBrandInquiry(b.name)">
              Send Inquiry
            </button>
          </div>
        </article>
      </template>
    </div>
  </section>

  <!-- BRAND PRODUCTION TIMELINE -->
  <section id="production-timeline" class="max-w-7xl mx-auto px-4 py-20 bg-neutral-900/40 rounded-3xl">
  </section>

<!-- INTRODUCTION EMAIL -->
  <section id="intro" class="max-w-7xl mx-auto px-4 py-16 bg-neutral-900/40 rounded-3xl">
    <h2 class="text-3xl font-bold mb-4">Get an Introduction Email</h2>
    <p class="text-neutral-300 mb-6">Enter your details to receive a professional introduction email about our services. A copy goes to you and to our inbox automatically.</p>
    <form @submit.prevent="sendIntro" class="space-y-4 max-w-xl">
      <input required x-model="intro.name" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="Full Name"/>
      <input required x-model="intro.email" type="email" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="Email Address"/>
      <input required x-model="intro.phone" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="Phone Number"/>
      <button class="px-6 py-3 rounded-2xl brand-gradient text-black font-bold">Send Introduction Email</button>
      <p x-show="introSuccess" class="text-emerald-400 text-sm mt-1">âœ… Email sent successfully!</p>
      <p x-show="introError" class="text-red-400 text-sm mt-1" x-text="introError"></p>
    </form>
  </section>

  <!-- SHOP -->
  <section id="shop" class="max-w-7xl mx-auto px-4 py-20">
    <div class="flex items-end justify-between gap-4 mb-6">
      <div>
        <h2 class="text-3xl font-extrabold">Browse Tires</h2>
        <p class="text-neutral-400">Search and filter by brand to view our product catalog.</p>
        <p class="text-amber-400 text-sm mt-1" x-show="bulkMode" x-cloak>For bulk orders and wholesale inquiries</p>
      </div>
      <div class="flex gap-2 items-center">
        <label class="flex items-center gap-2 text-sm cursor-pointer">
          <input type="checkbox" x-model="bulkMode" @change="toggleBulkMode()" class="rounded">
          <span>Bulk Mode</span>
        </label>
        <select x-model="selectedCurrency" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2">
          <option value="USD">USD ($)</option>
          <option value="AED">AED (Ø¯.Ø¥)</option>
        </select>
        <select x-model="filters.brand" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2">
          <option value="">All brands</option>
          <option>Duraturn</option>
          <option>Bridgestone</option>
          <option>Firemax</option>
        </select>
        <input x-model="filters.query" type="search" placeholder="Search sizeâ€¦ e.g., 205/55R16" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 placeholder:text-neutral-500" />
      </div>
    </div>

    <!-- Interactive Tire Universe Sliders -->
    <div 
      id="tire-universe-sliders"
      class="mb-12 glass rounded-3xl p-8 border-white/10 transition-all duration-700"
      :class="slidersDocked ? 'slider-docked' : ''"
      :style="slidersDocked ? 'position: fixed; top: 120px; right: 20px; width: 320px; z-index: 50; box-shadow: 0 20px 50px rgba(0,0,0,0.5);' : ''"
    >
      <div class="flex items-center justify-between mb-4">
        <div>
          <h3 class="text-2xl font-bold">Interactive Tire Universe</h3>
          <p class="text-neutral-400 text-sm">Explore tires visually â€” adjust the sliders to see products react</p>
        </div>
        <button 
          @click="toggleSlidersDocked()"
          class="ml-4 px-3 py-2 rounded-lg bg-white/5 hover:bg-white/10 border border-white/10 hover:border-white/20 transition-all text-sm font-semibold whitespace-nowrap"
          :title="slidersDocked ? 'Undock Controls' : 'Dock Controls'"
        >
          <span x-text="slidersDocked ? 'â† Undock' : 'Dock â†’'"></span>
        </button>
      </div>
      
      <div class="max-w-3xl space-y-6" :class="slidersDocked ? '' : 'mx-auto'">
        <!-- Slider 1: City <-> Highway -->
        <div>
          <div class="flex justify-between items-center mb-2">
            <label class="text-sm font-semibold text-neutral-300">City</label>
            <label class="text-sm font-semibold text-neutral-300">Highway</label>
          </div>
          <input 
            type="range" 
            min="0" 
            max="100" 
            x-model.number="tireUniverse.drivingType"
            class="w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer slider"
          />
        </div>

        <!-- Slider 2: Budget <-> Performance -->
        <div>
          <div class="flex justify-between items-center mb-2">
            <label class="text-sm font-semibold text-neutral-300">Budget</label>
            <label class="text-sm font-semibold text-neutral-300">Performance</label>
          </div>
          <input 
            type="range" 
            min="0" 
            max="100" 
            x-model.number="tireUniverse.priority"
            class="w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer slider"
          />
        </div>

        <!-- Slider 3: Quiet <-> Aggressive -->
        <div>
          <div class="flex justify-between items-center mb-2">
            <label class="text-sm font-semibold text-neutral-300">Quiet</label>
            <label class="text-sm font-semibold text-neutral-300">Aggressive</label>
          </div>
          <input 
            type="range" 
            min="0" 
            max="100" 
            x-model.number="tireUniverse.drivingStyle"
            class="w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer slider"
          />
        </div>
      </div>
    </div>

    <!-- PODIUM STAGE (separate from product grid) -->
    <div class="mb-12 relative" style="height: 650px;">
      <div class="absolute inset-0 glass rounded-3xl border-white/10 overflow-hidden">
        <h3 class="text-xl font-bold text-center pt-4 pb-2">Podium Ranking</h3>
        
        <!-- 6 Fixed Podium Slots -->
        <div class="relative w-full h-full">
          <template x-for="p in products" :key="p.id">
            <div 
              :id="'podium-' + p.id"
              class="absolute podium-card glass rounded-2xl overflow-hidden border-white/10"
              :style="getPodiumSlotStyle(p)"
              style="width: 200px; transition: all 1.4s cubic-bezier(0.22, 1, 0.36, 1);"
            >
              <button
                class="favorite-toggle absolute top-2"
                style="inset-inline-start: 0.5rem;"
                :class="{ 'is-active': isFavorite(p.id), 'is-animating': favoriteAnimations[p.id] }"
                :aria-pressed="isFavorite(p.id)"
                title="Toggle favorite"
                @click.stop="toggleFavorite(p)"
              >
                <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M12 21s-7-4.35-9.33-8.4C.9 9.05 2.28 5.5 5.72 4.65A5.35 5.35 0 0 1 12 7.08a5.35 5.35 0 0 1 6.28-2.43c3.44.85 4.82 4.4 3.05 7.95C19 16.65 12 21 12 21z"/>
                </svg>
              </button>
              <!-- Rank Badge -->
              <div 
                class="absolute top-2 right-2 w-12 h-12 rounded-full flex flex-col items-center justify-center font-bold text-white shadow-lg z-10"
                :style="{ background: getRankBadge(p).bg }"
              >
                <div class="text-xl" x-text="getRankBadge(p).medal"></div>
                <div class="text-xs" x-text="getRankBadge(p).text"></div>
              </div>
              
              <img :src="p.img" :alt="p.name" class="w-full h-32 object-contain bg-black/20"/>
              <div class="p-3">
                <h4 class="font-bold text-sm mb-1" x-text="p.name"></h4>
                <div 
                  class="text-xs font-semibold mb-1"
                  :style="{ color: getVerdictText(p).color }"
                  x-text="getVerdictText(p).text"
                ></div>
                <p class="text-neutral-400 text-xs" x-text="p.size"></p>
              </div>
            </div>
          </template>
        </div>
      </div>
    </div>

    <!-- Original Product Grid (unchanged) -->
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-5">
      <template x-for="p in filteredProducts()" :key="p.id">
        <article 
          class="glass rounded-3xl overflow-hidden shine border-white/10"
          :class="isCompared(p.id) ? 'ring-2 ring-emerald-400/70' : ''"
        >
          <div class="relative">
            <img :src="p.img" :alt="p.name" class="w-full h-48 object-contain bg-black/30"/>
            <button
              class="favorite-toggle absolute top-3"
              style="inset-inline-end: 0.75rem;"
              :class="{ 'is-active': isFavorite(p.id), 'is-animating': favoriteAnimations[p.id] }"
              :aria-pressed="isFavorite(p.id)"
              title="Toggle favorite"
              @click.stop="toggleFavorite(p)"
            >
              <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 21s-7-4.35-9.33-8.4C.9 9.05 2.28 5.5 5.72 4.65A5.35 5.35 0 0 1 12 7.08a5.35 5.35 0 0 1 6.28-2.43c3.44.85 4.82 4.4 3.05 7.95C19 16.65 12 21 12 21z"/>
              </svg>
            </button>
          </div>
          <div class="p-4 space-y-2">
            <div class="flex items-center justify-between gap-2">
              <h3 class="font-bold" x-text="p.name"></h3>
              <span class="text-xs px-2 py-1 rounded-full bg-white/10" x-text="p.brand"></span>
            </div>
            <div 
              class="text-sm font-semibold"
              :style="{ color: getVerdictText(p).color }"
              x-text="getVerdictText(p).text"
              style="animation: fadeInScale 0.4s ease-out 0.15s both;"
            ></div>
            
            <p class="text-neutral-300 text-sm" x-text="p.desc"></p>

            <div class="flex items-center justify-between pt-2 border-t border-white/10">
              <label
                class="flex items-center gap-2 text-xs font-semibold"
                :class="isCompareDisabled(p.id) ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'"
              >
                <input
                  type="checkbox"
                  class="rounded border-white/20 bg-white/5 text-emerald-400 focus:ring-emerald-300/60"
                  :checked="isCompared(p.id)"
                  :disabled="isCompareDisabled(p.id)"
                  @change="toggleCompareSelection(p)"
                />
                <span>Compare</span>
              </label>
              <span
                class="text-xs text-amber-300"
                x-show="compareLimitReached && isCompareDisabled(p.id)"
                x-cloak
              >
                Limit reached
              </span>
            </div>
            
            <!-- Quick Questions Section -->
            <div class="pt-2 border-t border-white/10">
              <div class="flex items-center justify-between mb-2">
                <span class="text-xs font-semibold text-neutral-400">Quick questions</span>
                <button 
                  @click="refreshProductQuestions(p)" 
                  class="text-xs px-2 py-1 rounded-lg bg-white/5 hover:bg-white/10 text-neutral-300"
                  title="Refresh questions">
                  â†»
                </button>
              </div>
              <div class="space-y-1">
                <template x-for="(q, idx) in getProductQuestions(p)" :key="p.id + '-' + idx">
                  <button 
                    @click="openChatWithQuestion(q, p)"
                    class="w-full text-left text-xs px-2 py-1.5 rounded-lg bg-white/5 hover:bg-teal-500/20 text-neutral-300 hover:text-teal-300 transition-colors"
                    x-text="q">
                  </button>
                </template>
              </div>
            </div>
            
            <div class="flex items-center justify-between pt-2">
              <!-- Normal mode -->
              <template x-if="!bulkMode">
                <div class="flex items-center justify-between w-full">
                  <div>
                    <div class="text-lg font-extrabold" x-text="formatPrice(p.price)"></div>
                    <div class="text-xs text-neutral-400" x-text="p.size"></div>
                  </div>
                </div>
              </template>
              
              <!-- Bulk mode -->
              <template x-if="bulkMode">
                <div class="flex flex-col gap-2 w-full">
                  <div class="flex items-center justify-between">
                    <div>
                      <div class="text-sm text-neutral-400">Contact us for bulk pricing</div>
                      <div class="text-xs text-neutral-400" x-text="p.size"></div>
                    </div>
                  </div>
                  <button class="w-full px-4 py-2 rounded-xl bg-amber-500 text-black font-bold hover:opacity-90" @click="requestBulkQuote(p)">Request bulk quote</button>
                </div>
              </template>
            </div>
          </div>
        </article>
      </template>
    </div>
  </section>

  <!-- CONTACT -->
  <section id="contact" class="max-w-7xl mx-auto px-4 py-20">
    <h2 class="text-3xl font-bold mb-6">Contact Us</h2>
    <form @submit.prevent="sendContact" class="space-y-4 max-w-xl">
      <input required x-model="contact.name" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="Your name"/>
      <input required x-model="contact.email" type="email" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="Your email"/>
      <textarea required x-model="contact.message" rows="4" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="Your message"></textarea>
      <button class="px-6 py-3 rounded-2xl brand-gradient text-black font-bold">Send Message</button>
    </form>
  </section>

  <!-- FOOTER -->
  <footer class="border-t border-white/10 text-neutral-400 text-sm text-center py-6">
    Â© <span x-text="new Date().getFullYear()"></span> Aslama Alteeba. All rights reserved.
  </footer>

  <div
    class="fixed bottom-24 right-5 z-40"
    x-show="compareSelection.length"
    x-transition.opacity.duration.200ms
    x-cloak
  >
    <div class="glass rounded-2xl border border-white/10 px-4 py-3 shadow-xl flex items-center gap-3">
      <div>
        <div class="text-sm font-semibold">Compare <span x-text="compareSelection.length"></span>/3</div>
        <p class="text-xs text-amber-300" x-show="compareLimitReached" x-text="compareLimitMessage"></p>
      </div>
      <a
        href="/compare.html"
        class="px-4 py-2 rounded-xl bg-emerald-400 text-black font-bold"
        @click="persistCompareSelection()"
      >
        Compare
      </a>
    </div>
  </div>


  <!-- AI CHAT PANEL -->
  <div class="fixed bottom-5 left-5 z-50">
    <button
      class="px-4 py-3 rounded-2xl brand-gradient text-black font-extrabold shadow-lg hover:opacity-90"
      @click="chatOpen = !chatOpen; if(chatOpen){$nextTick(() => scrollChat());}"
      aria-label="Open AI chat"
    >
      AI Chat
    </button>
  </div>

  <div
    class="fixed bottom-20 left-5 z-50 w-[92vw] max-w-md"
    x-show="chatOpen"
    x-transition
    @keydown.escape.window="chatOpen=false"
  >
    <div class="glass rounded-3xl border border-white/10 overflow-hidden">
      <div class="flex items-center justify-between px-4 py-3 bg-black/40">
        <div>
          <div class="font-bold">Aslama AI Assistant</div>
          <div class="text-xs text-neutral-400">Ask about sizes, brands, or availability.</div>
        </div>
        <button class="p-2 rounded-lg bg-white/5" @click="chatOpen=false">âœ•</button>
      </div>

      <div class="max-h-80 overflow-y-auto px-4 py-3 space-y-3" x-ref="chatScroll">
        <template x-for="(msg, idx) in chatMessages" :key="idx">
          <div class="flex" :class="msg.role === 'user' ? 'justify-end' : 'justify-start'">
            <div
              class="px-3 py-2 rounded-2xl text-sm max-w-[80%]"
              :class="msg.role === 'user' ? 'bg-emerald-500 text-black' : 'bg-white/10 text-neutral-100'"
              x-text="msg.content"
            ></div>
          </div>
        </template>

        <template x-if="chatLoading">
          <div class="flex justify-start">
            <div class="px-3 py-2 rounded-2xl text-sm bg-white/10 text-neutral-100">Typingâ€¦</div>
          </div>
        </template>
      </div>

      <div class="border-t border-white/10 px-3 py-3 space-y-2">
        <p class="text-xs text-red-400" x-show="chatError" x-text="chatError"></p>
        <form class="flex gap-2" @submit.prevent="sendChatMessage()">
          <input
            x-model="chatInput"
            class="flex-1 bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-sm"
            placeholder="Type a question..."
            :disabled="chatLoading"
          />
          <button
            class="px-4 py-2 rounded-xl brand-gradient text-black font-bold"
            :disabled="chatLoading || !chatInput.trim()"
          >
            Send
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- WHATSAPP FLOAT BUTTON (ALWAYS VISIBLE) -->
  <a
    href="https://wa.me/971554637045?text=Hello%20Aslama%20Alteeba%2C%20I%20would%20like%20to%20inquire%20about%20tires."
    class="fixed bottom-5 right-5 z-50 px-4 py-3 rounded-2xl bg-emerald-500 text-black font-extrabold shadow-lg hover:opacity-90"
    aria-label="WhatsApp"
    target="_blank"
    rel="noopener"
    @click="trackWhatsAppUsage()"
  >
    WhatsApp
  </a>
  <div
    class="fixed top-20 z-50 space-y-2"
    style="inset-inline-end: 1rem;"
    x-show="toasts.length"
    x-cloak
  >
    <template x-for="toast in toasts" :key="toast.id">
      <div class="favorite-toast" x-text="toast.message"></div>
    </template>
  </div>
<!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    const EMAILJS_PUBLIC_KEY = "qkXfa4_PMbGhuWHaX";
    const EMAILJS_SERVICE_ID = "service_hhs4z1i";
    const EMAILJS_TEMPLATE_ID = "template_2djz9zc";   // orders + contact + brand inquiries
    const EMAILJS_INTRO_TEMPLATE = "template_efwbezh"; // introduction email

    if (EMAILJS_PUBLIC_KEY) emailjs.init({ publicKey: EMAILJS_PUBLIC_KEY });

    function appState(){
      // Restore preferences directly from localStorage before Alpine initializes
      // Reading directly ensures values are available synchronously
      let initialCurrency = 'USD';
      let initialBulkMode = false;
      let initialBrandFilter = '';
      let initialSlidersDocked = false;
      
      try {
        // Read directly from localStorage (synchronous, guaranteed to work)
        const savedCurrency = localStorage.getItem('aa_currency');
        if (savedCurrency && ['USD', 'AED'].includes(savedCurrency)) {
          initialCurrency = savedCurrency;
        }
        
        const savedBulkMode = localStorage.getItem('aa_bulkMode');
        if (savedBulkMode === 'true') {
          initialBulkMode = true;
        }
        
        const savedBrandFilter = localStorage.getItem('aa_brandFilter');
        if (savedBrandFilter) {
          initialBrandFilter = savedBrandFilter;
        }
        
        const savedSlidersDocked = localStorage.getItem('aa_slidersDocked');
        if (savedSlidersDocked === 'true') {
          initialSlidersDocked = true;
        }
      } catch (e) {
        // localStorage not available, use defaults
        console.warn('localStorage not available:', e);
      }
      
      const favoritesController = window.FavoritesUI
        ? FavoritesUI.createController()
        : {
            favorites: [],
            favoriteIdSet: new Set(),
            favoriteCount: 0,
            favoriteAnimations: {},
            toasts: [],
            prefersReducedMotion: false,
            initFavorites() {},
            isFavorite() { return false; },
            toggleFavorite() { return { added: false }; },
            addToast() {}
          };

      return {
        ...favoritesController,
        filters:{brand: initialBrandFilter, query:''},
        passengerBrandSelection:'',
        activePassengerBrand:'',
        contact:{name:'',email:'',message:''},
        intro:{name:'',email:'',phone:''},
        introSuccess:false,
        introError:'',
        chatOpen:false,
        chatInput:'',
        chatLoading:false,
        chatError:'',
        chatMessages:[
          {role:'assistant', content:'Welcome to Aslama Alteeba. How can the team help with tires, sizing, or availability?'}
        ],
        
        // Currency conversion
        selectedCurrency: initialCurrency,
        exchangeRates: { USD: 1, AED: 3.67 },
        currencySymbols: { USD: '$', AED: 'Ø¯.Ø¥' },

        // Bulk Mode
        bulkMode: initialBulkMode,

        // Sliders Docked Mode
        slidersDocked: initialSlidersDocked,

        // Interactive Tire Universe
        tireUniverse: {
          drivingType: 50,  // 0 = City, 100 = Highway
          priority: 50,     // 0 = Budget, 100 = Performance
          drivingStyle: 50, // 0 = Quiet, 100 = Aggressive
          scores: {},       // product scores cache
          ranks: {}         // product ranks (1-6)
        },
        
        toggleSlidersDocked(){
          this.slidersDocked = !this.slidersDocked;
          // Persist state
          if (window.CustomerMemory) {
            CustomerMemory.setSlidersDocked(this.slidersDocked);
          }
        },

        toggleBulkMode(){
          // Bulk mode is now automatically saved via watcher in init()
          // This method just toggles the value, the watcher handles persistence
        },

        requestBulkQuote(p){
          const text = `Hello, I'm requesting a bulk quote for:\n\n- Product: ${p.name}\n- Size: ${p.size}\n- Brand: ${p.brand}\n\nQuantity: `;
          window.open('https://wa.me/971554637045?text=' + encodeURIComponent(text), '_blank');
          // Track bulk quote usage
          if (window.CustomerMemory) {
            CustomerMemory.markBulkQuoteUsed();
          }
        },

        brands:[
          {name:'Firemax', img:'https://i.postimg.cc/nrLrwP86/firemax-logo-e-motors-ru-removebg-preview.png', desc:'Value-focused lineup for passenger and SUV needs.'},
          {name:'Duraturn', img:'https://i.postimg.cc/ZKGYrRq1/4h-HO1KRF0AYc-JDu3S1nl0w3a0n-OYIt-SV0vrue-CTf-png.webp', desc:'Affordable quality tires with strong touring and A/T options.'},
          {name:'Haida', img:'https://i.postimg.cc/yNYNNGxd/haidatireb.webp', desc:'Reliable tire range with a balance of durability and value.'},
          {name:'Vikrant', img:'https://i.postimg.cc/vZXQCvzS/Vikrant-Tyres-Logo.jpg', desc:'Tyres built for dependable performance and everyday use.'}
        ],

        passengerBrands:[
          {
            name:'Firemax',
            models:[
              {name:'FM601', img:'https://i.postimg.cc/brPywh61/FIREMAX-FM601.jpg', desc:''},
              {name:'FM518', img:'https://i.postimg.cc/mD2Vfz4g/firemax-fm518-8579-product.webp', desc:''},
              {name:'POTENTIA SPORT 2', img:'https://i.postimg.cc/Bb3Sn0h1/D-NQ-NP-625623-MLA101194871623-122025-O.webp', desc:''}
            ]
          },
          {
            name:'Kpatos',
            models:[
              {name:'Coming Soon', img:'https://placehold.co/600x400?text=Coming+Soon', desc:'Product lineup coming soon.'}
            ]
          },
          {
            name:'Dovroad',
            models:[
              {name:'Coming Soon', img:'https://placehold.co/600x400?text=Coming+Soon', desc:'Product lineup coming soon.'}
            ]
          },
          {
            name:'Haida',
            models:[
              {name:'Coming Soon', img:'https://placehold.co/600x400?text=Coming+Soon', desc:'Product lineup coming soon.'}
            ]
          },
          {
            name:'Neolin',
            models:[
              {name:'Coming Soon', img:'https://placehold.co/600x400?text=Coming+Soon', desc:'Product lineup coming soon.'}
            ]
          },
          {
            name:'Duraturn',
            models:[
              {name:'Coming Soon', img:'https://placehold.co/600x400?text=Coming+Soon', desc:'Product lineup coming soon.'}
            ]
          }
        ],

        products: window.TIRE_PRODUCTS || [],
        compareSelection: [],
        compareLimit: window.CompareState ? CompareState.limit : 3,
        compareLimitReached: false,
        compareLimitMessage: '',

        // Question generation templates
        questionTemplates: {
          intents: [
            'Is {subject} good for',
            'How does {subject} perform in',
            'Can {subject} handle',
            'Does {subject} work well for',
            'Is {subject} suitable for'
          ],
          contexts: [
            'daily highway driving in UAE heat',
            'city traffic and frequent stops',
            'long-distance desert trips',
            'wet roads and occasional rain',
            'off-road and rough terrain',
            'hot summer conditions',
            'mixed urban and highway use'
          ],
          subjects: [] // Generated dynamically per product
        },
        
        // Store generated questions per product
        productQuestions: {},

        async init(){
          this.initFavorites();
          const validIds = this.products.map(product => product.id);
          if (window.CompareState) {
            this.compareSelection = CompareState.normalize(CompareState.load(), validIds);
          }
          this.$watch('compareSelection', (value) => {
            if (window.CompareState) {
              CompareState.save(value);
            }
          });
          // Initialize tire universe scores
          this.updateTireScores();
          
          // Watch tire universe slider changes for immediate reactivity
          this.$watch('tireUniverse.drivingType', () => this.updateTireScores());
          this.$watch('tireUniverse.priority', () => this.updateTireScores());
          this.$watch('tireUniverse.drivingStyle', () => this.updateTireScores());
          
          // Set up watchers for CustomerMemory preferences
          if (window.CustomerMemory) {
            // Watch currency changes
            this.$watch('selectedCurrency', v => {
              localStorage.setItem('aa_currency', v);
              CustomerMemory.setCurrency(v);
            });
            
            // Watch brand filter changes
            this.$watch('filters.brand', v => {
              CustomerMemory.setBrandFilter(v);
            });
            
            // Watch bulk mode changes
            this.$watch('bulkMode', v => {
              CustomerMemory.setBulkMode(v);
            });
          } else {
            // Fallback to direct localStorage
            this.$watch('selectedCurrency', v => localStorage.setItem('aa_currency', v));
          }
          
          // Fetch exchange rates
          await this.fetchExchangeRates();
        },
        
        // Show welcome back message
        showWelcomeMessage(){
          if (!window.CustomerMemory) return;
          
          // Show welcome message after a short delay to ensure page is loaded
          setTimeout(() => {
            CustomerMemory.showWelcomeBack();
          }, 500);
        },
        
        // Track WhatsApp usage
        trackWhatsAppUsage(){
          if (window.CustomerMemory) {
            CustomerMemory.markWhatsAppUsed();
          }
        },
        
        async fetchExchangeRates(){
          try {
            const response = await fetch('/api/exchange-rates');
            const data = await response.json();
            if (data.rates) {
              this.exchangeRates = data.rates;
            }
          } catch (err) {
            console.error('Failed to fetch exchange rates:', err);
            // Keep using fallback rates already set
          }
        },
        
        convertPrice(usdPrice){
          if (this.selectedCurrency === 'USD') {
            return usdPrice;
          } else if (this.selectedCurrency === 'AED') {
            return usdPrice * this.exchangeRates.AED;
          }
          return usdPrice;
        },
        
        formatPrice(usdPrice){
          const converted = this.convertPrice(usdPrice);
          const symbol = this.currencySymbols[this.selectedCurrency] || '$';
          // AED and USD both use 2 decimal places
          return `${symbol}${converted.toFixed(2)}`;
        },

        isCompared(id){
          return this.compareSelection.includes(id);
        },

        isCompareDisabled(id){
          return this.compareSelection.length >= this.compareLimit && !this.isCompared(id);
        },

        toggleCompareSelection(product){
          if (this.isCompared(product.id)) {
            this.compareSelection = this.compareSelection.filter(id => id !== product.id);
            return;
          }
          if (this.compareSelection.length >= this.compareLimit) {
            this.compareLimitReached = true;
            this.compareLimitMessage = 'You can compare up to 3 tires.';
            window.setTimeout(() => {
              this.compareLimitReached = false;
              this.compareLimitMessage = '';
            }, 2000);
            return;
          }
          this.compareSelection = [...this.compareSelection, product.id];
        },

        persistCompareSelection(){
          if (window.CompareState) {
            CompareState.save(this.compareSelection);
          }
        },

        brandProductCount(brandName){
          return this.products.filter(p => p.brand === brandName).length;
        },

        passengerBrandModels(brandName){
          const brand = this.passengerBrands.find(b => b.name === brandName);
          return brand ? brand.models : [];
        },

        filteredProducts(){
          return this.products.filter(p => {
            const brandMatch = !this.filters.brand || p.brand === this.filters.brand;
            const q = this.filters.query.trim().toLowerCase();
            const queryMatch = !q || (p.name + ' ' + p.size).toLowerCase().includes(q);
            return brandMatch && queryMatch;
          });
        },

        // Interactive Tire Universe Methods
        updateTireScores(){
          // Build new scores object to trigger Alpine reactivity
          const newScores = {};
          this.products.forEach(p => {
            newScores[p.id] = this.calculateProductScore(p);
          });
          
          // RANK SNAPPING: Normalize score spread and force minimum distance
          const sortedProducts = [...this.products].sort((a, b) => 
            (newScores[b.id] || 0) - (newScores[a.id] || 0)
          );
          
          // Force score separation: ensure minimum 8-point gaps between ranks
          const minGap = 8;
          for (let i = 1; i < sortedProducts.length; i++) {
            const prevScore = newScores[sortedProducts[i-1].id];
            const currScore = newScores[sortedProducts[i].id];
            
            if (prevScore - currScore < minGap) {
              // Adjust current score to maintain minimum gap
              newScores[sortedProducts[i].id] = prevScore - minGap;
            }
          }
          
          // Re-sort after adjustments
          sortedProducts.sort((a, b) => 
            (newScores[b.id] || 0) - (newScores[a.id] || 0)
          );
          
          // Assign ranks - build new object to trigger Alpine reactivity
          const newRanks = {};
          sortedProducts.forEach((p, index) => {
            newRanks[p.id] = index + 1; // Ranks 1-6
          });
          
          // Assign both new objects in single operations to trigger reactivity
          this.tireUniverse.scores = newScores;
          this.tireUniverse.ranks = newRanks;
        },

        calculateProductScore(product){
          const { drivingType, priority, drivingStyle } = this.tireUniverse;
          
          // NON-LINEAR AMPLIFICATION: Apply power curve to slider deltas from center
          const amplifyDelta = (sliderValue) => {
            const delta = sliderValue - 50; // Distance from center
            const sign = Math.sign(delta);
            const absDelta = Math.abs(delta);
            // Power curve: small movements get amplified more
            const amplified = sign * Math.pow(absDelta, 1.6);
            return 50 + amplified; // Return amplified slider position
          };
          
          const amplifiedDrivingType = amplifyDelta(drivingType);
          const amplifiedPriority = amplifyDelta(priority);
          const amplifiedDrivingStyle = amplifyDelta(drivingStyle);
          
          // DOMINANCE THRESHOLD: Check if any slider is Â±10 from center (increased sensitivity)
          const drivingTypeDelta = Math.abs(drivingType - 50);
          const priorityDelta = Math.abs(priority - 50);
          const drivingStyleDelta = Math.abs(drivingStyle - 50);
          
          const drivingTypeDominant = drivingTypeDelta >= 10;
          const priorityDominant = priorityDelta >= 10;
          const drivingStyleDominant = drivingStyleDelta >= 10;
          
          // Get price percentile (0-100)
          const prices = this.products.map(p => p.price);
          const minPrice = Math.min(...prices);
          const maxPrice = Math.max(...prices);
          const pricePercentile = maxPrice > minPrice 
            ? ((product.price - minPrice) / (maxPrice - minPrice)) * 100 
            : 50;
          
          // Brand category (performance tier)
          const brandTier = {
            'Bridgestone': 85,
            'Firemax': 45,
            'Duraturn': 60
          }[product.brand] || 50;
          
          // Keyword matching from description
          const desc = (product.desc || '').toLowerCase();
          const name = (product.name || '').toLowerCase();
          const text = desc + ' ' + name;
          
          // City vs Highway keywords (using AMPLIFIED slider value)
          const cityKeywords = ['city', 'urban', 'comfort', 'quiet', 'smooth', 'touring'];
          const highwayKeywords = ['highway', 'speed', 'stability', 'long', 'distance'];
          const cityScore = cityKeywords.filter(k => text.includes(k)).length * 20;
          const highwayScore = highwayKeywords.filter(k => text.includes(k)).length * 20;
          const drivingTypeScore = 100 - Math.abs(amplifiedDrivingType - (highwayScore - cityScore + 50));
          
          // Budget vs Performance - correlate with price percentile and brand (using AMPLIFIED value)
          const performanceIndicator = (pricePercentile * 0.6) + (brandTier * 0.4);
          const priorityScore = 100 - Math.abs(amplifiedPriority - performanceIndicator);
          
          // Quiet vs Aggressive keywords (using AMPLIFIED value)
          const quietKeywords = ['quiet', 'comfort', 'smooth', 'refined', 'touring'];
          const aggressiveKeywords = ['sport', 'performance', 'grip', 'traction', 'aggressive'];
          const quietScore = quietKeywords.filter(k => text.includes(k)).length * 20;
          const aggressiveScore = aggressiveKeywords.filter(k => text.includes(k)).length * 20;
          const drivingStyleScore = 100 - Math.abs(amplifiedDrivingStyle - (aggressiveScore - quietScore + 50));
          
          // DOMINANCE-BASED WEIGHTING
          let weights = { drivingType: 0.33, priority: 0.34, drivingStyle: 0.33 };
          
          if (drivingTypeDominant || priorityDominant || drivingStyleDominant) {
            // When a dimension is dominant, boost its weight significantly
            weights = { drivingType: 0.15, priority: 0.15, drivingStyle: 0.15 };
            
            if (drivingTypeDominant) weights.drivingType = 0.55;
            if (priorityDominant) weights.priority = 0.55;
            if (drivingStyleDominant) weights.drivingStyle = 0.55;
            
            // Normalize
            const totalWeight = weights.drivingType + weights.priority + weights.drivingStyle;
            weights.drivingType /= totalWeight;
            weights.priority /= totalWeight;
            weights.drivingStyle /= totalWeight;
          }
          
          // Weighted average with dynamic weights
          const finalScore = (drivingTypeScore * weights.drivingType) + 
                            (priorityScore * weights.priority) + 
                            (drivingStyleScore * weights.drivingStyle);
          
          return Math.max(0, Math.min(100, finalScore));
        },

        getPodiumSlotStyle(product){
          const rank = this.tireUniverse.ranks[product.id] || 3;
          
          // 6 FIXED PODIUM SLOTS using absolute positioning
          // Centered horizontally, different vertical positions
          const containerWidth = 1000; // approximate podium stage width
          const cardWidth = 200;
          const centerX = (containerWidth - cardWidth) / 2;
          
          const podiumSlots = {
            // Tier 1 - Winner (#1) - Center, highest
            1: { 
              top: 80,
              left: centerX,
              scale: 1.25,
              opacity: 1.0,
              zIndex: 110,
              tier: 1,
              delay: 0.6 // Settles last
            },
            // Tier 2 - Runners-up (#2-3) - Left/right, slightly lower
            2: { 
              top: 160,
              left: centerX - 240,
              scale: 1.08,
              opacity: 0.95,
              zIndex: 108,
              tier: 2,
              delay: 0.3
            },
            3: { 
              top: 160,
              left: centerX + 240,
              scale: 1.08,
              opacity: 0.95,
              zIndex: 108,
              tier: 2,
              delay: 0.3
            },
            // Tier 3 - Lower (#4-6) - Row at bottom
            4: { 
              top: 400,
              left: centerX - 240,
              scale: 0.90,
              opacity: 0.75,
              zIndex: 105,
              tier: 3,
              delay: 0
            },
            5: { 
              top: 400,
              left: centerX,
              scale: 0.90,
              opacity: 0.70,
              zIndex: 105,
              tier: 3,
              delay: 0
            },
            6: { 
              top: 400,
              left: centerX + 240,
              scale: 0.90,
              opacity: 0.65,
              zIndex: 105,
              tier: 3,
              delay: 0
            }
          };
          
          const slot = podiumSlots[rank] || podiumSlots[3];
          
          // Enhanced glow for top 3
          let boxShadow = 'none';
          if (rank === 1) {
            boxShadow = '0 0 25px rgba(0, 224, 164, 0.7)';
          } else if (rank === 2 || rank === 3) {
            boxShadow = '0 0 15px rgba(0, 224, 164, 0.4)';
          }
          
          // Desaturate Tier 3
          const filter = slot.tier === 3 ? 'saturate(0.7) brightness(0.85)' : 'none';
          
          return {
            top: `${slot.top}px`,
            left: `${slot.left}px`,
            transform: `scale(${slot.scale})`,
            opacity: slot.opacity,
            zIndex: slot.zIndex,
            boxShadow: boxShadow,
            filter: filter,
            transitionDelay: `${slot.delay}s`
          };
        },

        getRankBadge(product){
          const rank = this.tireUniverse.ranks[product.id] || 3;
          
          const badges = {
            1: { text: '#1', bg: 'linear-gradient(135deg, #FFD700, #FFA500)', medal: 'ðŸ¥‡' },
            2: { text: '#2', bg: 'linear-gradient(135deg, #C0C0C0, #A8A8A8)', medal: 'ðŸ¥ˆ' },
            3: { text: '#3', bg: 'linear-gradient(135deg, #CD7F32, #8B4513)', medal: 'ðŸ¥‰' },
            4: { text: '#4', bg: 'linear-gradient(135deg, #708090, #556B2F)', medal: '' },
            5: { text: '#5', bg: 'linear-gradient(135deg, #FF8C00, #FF6347)', medal: '' },
            6: { text: '#6', bg: 'linear-gradient(135deg, #DC143C, #8B0000)', medal: '' }
          };
          
          return badges[rank] || badges[3];
        },

        getVerdictText(product){
          const rank = this.tireUniverse.ranks[product.id] || 3;
          
          const verdicts = {
            1: { text: 'Best match for your driving', color: '#059669' },
            2: { text: 'Very strong alternative', color: '#10B981' },
            3: { text: 'Acceptable match', color: '#F59E0B' },
            4: { text: 'Not ideal for your use', color: '#FB923C' },
            5: { text: 'Poor match', color: '#EF4444' },
            6: { text: 'Wrong choice for your driving', color: '#991B1B' }
          };
          
          return verdicts[rank] || verdicts[3];
        },

        getProductExplanation(product){
          const score = this.tireUniverse.scores[product.id] || 50;
          
          // Only show explanation for highly aligned products
          if (score < 65) return '';
          
          const { drivingType, priority, drivingStyle } = this.tireUniverse;
          
          // Determine primary alignment
          const explanations = [];
          
          if (drivingType > 65) {
            explanations.push('Better match for highway driving');
          } else if (drivingType < 35) {
            explanations.push('Better match for city driving');
          }
          
          if (priority > 65) {
            explanations.push('Aligned with performance focus');
          } else if (priority < 35) {
            explanations.push('Aligned with budget priority');
          }
          
          if (drivingStyle > 65) {
            explanations.push('Suited for aggressive driving');
          } else if (drivingStyle < 35) {
            explanations.push('Suited for quiet comfort');
          }
          
          // Return the most relevant explanation
          return explanations[0] || 'Well-aligned with your preferences';
        },

        // Generate product subject for questions
        getProductSubject(product){
          // Use brand + model/name if available, otherwise "this tire"
          if (product.brand && product.name) {
            // Extract model name if it includes brand
            const modelName = product.name.replace(product.brand, '').trim();
            return modelName ? `${product.brand} ${modelName}` : product.brand;
          }
          return 'this tire';
        },

        // Generate 3 unique questions for a product
        generateQuestions(product){
          const subject = this.getProductSubject(product);
          const subjectWithSize = product.size ? `${subject} (${product.size})` : subject;
          
          // Create pool of all possible combinations
          const allCombinations = [];
          this.questionTemplates.intents.forEach(intent => {
            this.questionTemplates.contexts.forEach(context => {
              allCombinations.push({
                intent,
                context,
                question: intent.replace('{subject}', subjectWithSize) + ' ' + context + '?'
              });
            });
          });
          
          // Shuffle all combinations
          const shuffled = allCombinations.sort(() => Math.random() - 0.5);
          
          // Pick 3 with no adjacent duplicate intents (with retry limit)
          const selected = [];
          for (let i = 0; i < shuffled.length && selected.length < 3; i++) {
            const candidate = shuffled[i];
            // Check if this intent was just used
            if (selected.length === 0 || selected[selected.length - 1].intent !== candidate.intent) {
              selected.push(candidate);
            }
          }
          
          // Fallback: if we couldn't find 3, just take first 3 (unlikely with 35 combinations)
          while (selected.length < 3 && selected.length < shuffled.length) {
            selected.push(shuffled[selected.length]);
          }
          
          return selected.map(s => s.question);
        },

        // Get or generate questions for a product
        getProductQuestions(product){
          if (!this.productQuestions[product.id]) {
            this.productQuestions[product.id] = this.generateQuestions(product);
          }
          return this.productQuestions[product.id];
        },

        // Refresh questions for a specific product
        refreshProductQuestions(product){
          this.productQuestions[product.id] = this.generateQuestions(product);
        },

        // Open AI chat with pre-filled question and product context
        openChatWithQuestion(question, product){
          const priceInfo = this.formatPrice(product.price);
          const context = `For ${this.getProductSubject(product)}${product.size ? ' (' + product.size + ')' : ''}${product.desc ? ', ' + product.desc : ''} - Price: ${priceInfo}`;
          const fullMessage = `${question}\n\n[Product context: ${context}]`;
          
          // Open the AI chat widget
          const chatBtn = document.querySelector('.ai-chat-btn');
          const chatBox = document.querySelector('.ai-chat-box');
          if (chatBtn && chatBox) {
            chatBox.style.display = 'flex';
            chatBox.style.flexDirection = 'column';
            
            // Pre-fill the input and auto-send
            const chatInput = chatBox.querySelector('.ai-chat-input');
            const sendBtn = chatBox.querySelector('.ai-chat-send');
            if (chatInput && sendBtn) {
              chatInput.value = fullMessage;
              // Auto-send the message by clicking the send button
              sendBtn.click();
            }
          }
        },

        // send two emails with the standard template (orders/contact/brand inquiries)
        async sendTwoEmails(params){
          await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {...params, to_email: 'Ilimot2012@gmail.com'});
          await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {...params, to_email: params.customer_email || params.from_email});
        },

        // BRAND INQUIRY
        async sendBrandInquiry(brandName){
          const list = this.products.filter(p => p.brand === brandName);
          const lines = list.length
            ? list.map(p => `â€¢ ${p.name} (${p.size}) â€” $${p.price.toFixed(2)}`).join('\n')
            : 'No products listed for this brand yet.';

          const params = {
            subject_line: `Brand Inquiry â€” ${brandName}`,
            from_name: 'Website Visitor',
            from_email: 'no-reply@alsamalteeba.netlify.app',
            customer_email: 'no-reply@alsamalteeba.netlify.app',
            message: `A visitor requested information about ${brandName}.`,
            brand_name: brandName,
            brand_products: lines
          };

          try {
            await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {...params, to_email: 'Ilimot2012@gmail.com'});
            alert('âœ… Inquiry sent! We will contact you soon.');
          } catch (err){
            console.error(err);
            alert('âŒ Error sending inquiry: ' + (err?.text || err?.message || 'Unknown'));
          }
        },

        // CONTACT
        async sendContact(){
          const params = {
            subject_line: 'Contact â€” Aslama Alteeba',
            from_name: this.contact.name,
            from_email: this.contact.email,
            customer_email: this.contact.email,
            message: this.contact.message
          };
          try {
            await this.sendTwoEmails(params);
            alert('âœ… Message sent!');
            this.contact = {name:'',email:'',message:''};
          } catch (err){
            console.error(err);
            alert('âŒ Error sending message: ' + (err?.text || err?.message || 'Unknown'));
          }
        },

        // INTRO EMAIL (uses dedicated template)
        async sendIntro(){
          this.introSuccess = false; this.introError = '';
          const params = {
            subject_line: 'Introduction Request â€” Aslama Alteeba',
            from_name: this.intro.name,
            from_email: this.intro.email,
            customer_email: this.intro.email,
            phone: this.intro.phone
          };
          try {
            await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_INTRO_TEMPLATE, {...params, to_email: 'Ilimot2012@gmail.com'});
            await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_INTRO_TEMPLATE, {...params, to_email: params.customer_email});
            this.introSuccess = true;
            this.intro = {name:'',email:'',phone:''};
          } catch(err){
            console.error(err);
            this.introError = 'Error: ' + (err?.text || err?.message || 'Unknown');
          }
        },

        scrollChat(){
          const el = this.$refs.chatScroll;
          if (el) el.scrollTop = el.scrollHeight;
        },

        async sendChatMessage(){
          const content = this.chatInput.trim();
          if (!content || this.chatLoading) return;
          this.chatError = '';
          this.chatMessages.push({role:'user', content});
          this.chatInput = '';
          this.chatLoading = true;
          this.$nextTick(() => this.scrollChat());
          try {
            const response = await fetch('/api/chat', {
              method: 'POST',
              headers: {'Content-Type':'application/json'},
              body: JSON.stringify({message: content})
            });
            const data = await response.json().catch(() => ({}));
            if (!response.ok) {
              throw new Error(data?.error || data?.message || 'Failed to get AI response');
            }
            const reply = (data?.reply || '').trim() || 'Thanks for your question. The team will follow up soon.';
            this.chatMessages.push({role:'assistant', content: reply});
          } catch(err) {
            const msg = err?.message || 'AI chat is unavailable right now.';
            this.chatError = msg;
            this.chatMessages.push({role:'assistant', content: 'Sorry, the assistant is unavailable right now. Please try again later.'});
          } finally {
            this.chatLoading = false;
            this.$nextTick(() => this.scrollChat());
          }
        }
      }
    }
  </script>

 <script src="/chat.js" defer></script>
  <script type="module">
    import { initBrandTimeline } from '/components/BrandTimeline.js';
    initBrandTimeline('en');
  </script>
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import {
    getAuth,
    onAuthStateChanged,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    signOut,
    sendEmailVerification,
    GoogleAuthProvider,
    signInWithPopup,
    setPersistence,
    browserLocalPersistence
  } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
  import {
    getFirestore,
    doc,
    getDoc,
    setDoc
  } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD5vnHsA23Uw3snDvu4qvqSh5wgRtDTMSc",
    authDomain: "aslamalteeba-2.firebaseapp.com",
    projectId: "aslamalteeba-2",
    storageBucket: "aslamalteeba-2.firebasestorage.app",
    messagingSenderId: "1004820564683",
    appId: "1:1004820564683:web:9833a031e3fa62a365e94e"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // ðŸ”’ Make "stay signed in" the default
  setPersistence(auth, browserLocalPersistence);

  // ðŸŒ Expose auth globally so chat.js can see it later
  window.firebaseAuth = auth;
  window.firebaseAuthAPI = {
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    signOut,
    sendEmailVerification,
    GoogleAuthProvider,
    signInWithPopup,
    onAuthStateChanged
  };
  
  // ðŸŒ Expose Firestore globally
  window.firebaseDB = db;
  window.firebaseFirestoreAPI = {
    doc,
    getDoc,
    setDoc
  };

  // Auth state management
  const signInBtn = document.getElementById("authSignInBtn");
  const signOutBtn = document.getElementById("authSignOutBtn");

  onAuthStateChanged(auth, async (user) => {
    console.log("AUTH STATE:", user ? user.email : "SIGNED OUT");
    
    if (user) {
      // User is signed in - show sign out, hide sign in
      signInBtn.style.display = "none";
      signOutBtn.style.display = "block";
    } else {
      // User is signed out - show sign in, hide sign out
      signInBtn.style.display = "block";
      signOutBtn.style.display = "none";
    }
  });

  // Sign out handler
  signOutBtn.addEventListener("click", async () => {
    try {
      await signOut(auth);
    } catch (err) {
      console.error("Sign out error:", err);
    }
  });

  // Profile icon click handler - checks auth state at click time
  window.handleProfileClick = function() {
    const user = window.firebaseAuth?.currentUser;
    if (user) {
      // User is signed in - go to profile page
      window.location.href = "/profile.html";
    } else {
      // User is signed out - go to auth page
      window.location.href = "/auth.html";
    }
  };
</script>
</body>
</html>
