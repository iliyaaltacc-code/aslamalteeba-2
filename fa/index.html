<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ุงุณููู ุงูุทุจู โ ูุฑูุดฺฏุงู ุชุงุฑ</title>
  <meta name="description" content="ุงุณููู ุงูุทุจู: ุชุงูู ฺฉููุฏู ุชุงุฑูุง ุจุงฺฉูุช ุฏุฑ ุงูุงุฑุงุช. ุจุฑูุฏูุง Duraturnุ Bridgestoneุ Firemax ุจุง ฺฉูุช ู ุงุทููุงู." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <style>
    html,body{font-family:Vazirmatn,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
    .glass{backdrop-filter: blur(12px); background: rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1)}
    .brand-gradient{background:linear-gradient(135deg,#00E0A4,#32D5FF)}
    .shine{position:relative;overflow:hidden}
    .shine:after{content:"";position:absolute;inset:-120% auto auto -120%;width:60%;height:300%;transform:rotate(25deg);background:linear-gradient(90deg,transparent,rgba(255,255,255,.18),transparent);animation:shine 6s infinite}
    [x-cloak]{display:none !important}
    @keyframes shine{0%{left:-120%}60%{left:140%}100%{left:140%}}
  </style>
</head>
<body class="bg-neutral-950 text-neutral-100" x-data="appState()" x-init="init()">
  <!-- HEADER -->
  <header class="sticky top-0 z-50 glass">
    <div class="max-w-7xl mx-auto flex items-center justify-between px-4 py-3">
      <h1 class="text-xl font-extrabold tracking-tight">Aslama <span class="text-emerald-400">Alteeba</span></h1>
      <nav class="hidden md:flex gap-6 text-sm">
        <a href="#about" class="hover:text-white">ุฏุฑุจุงุฑู ูุง</a>
        <div class="relative" x-data="{open:false}">
          <button class="hover:text-white flex items-center gap-2" aria-haspopup="true" :aria-expanded="open" @click="open = !open" @keydown.escape="open=false">
            ูุญุตููุงุช
            <span class="text-xs text-neutral-400">โพ</span>
          </button>
          <div class="absolute right-0 top-full mt-2 w-72 rounded-2xl border border-white/10 bg-neutral-950/95 backdrop-blur p-2 shadow-xl" x-show="open" x-transition.origin.top.right @click.outside="open=false" x-cloak>
            <a href="#passenger-car-tires" class="block rounded-xl px-3 py-2 text-sm text-neutral-200 hover:bg-white/10" @click="open=false">ุชุงุฑ ุณูุงุฑ</a>
            <a href="#truck-bus-radial-tires" class="block rounded-xl px-3 py-2 text-sm text-neutral-200 hover:bg-white/10" @click="open=false">ุชุงุฑ ุฑุงุฏุงู ฺฉุงููู ู ุงุชูุจูุณ</a>
            <a href="#otr-tires" class="block rounded-xl px-3 py-2 text-sm text-neutral-200 hover:bg-white/10" @click="open=false">ุชุงุฑ OTR</a>
            <a href="#truck-bus-bias-tires" class="block rounded-xl px-3 py-2 text-sm text-neutral-200 hover:bg-white/10" @click="open=false">ุชุงุฑ ุจุงุงุณ ฺฉุงููู ู ุงุชูุจูุณ</a>
          </div>
        </div>
        <a href="#hq" class="hover:text-white">ุฏูุชุฑ ูุฑฺฉุฒ</a>
        <a href="#imports" class="hover:text-white">ูุงุฑุฏุงุช</a>
        <a href="#shipping" class="hover:text-white">ุงุฑุณุงู</a>
        <a href="#brands" class="hover:text-white">ุจุฑูุฏูุง</a>
        <a href="#intro" class="hover:text-white">ุงูู ูุนุฑู</a>
        <a href="#shop" class="hover:text-white">ูุฑูุดฺฏุงู</a>
        <a href="#contact" class="hover:text-white">ุชูุงุณ</a>
      </nav>
      <div class="flex items-center gap-2">
        <button class="px-3 py-2 rounded-xl bg-white/10 border border-white/10" @click="cartOpen=true">
          ุณุจุฏ ุฎุฑุฏ <span class="ml-1 text-emerald-400 font-bold" x-text="cart.length"></span>
        </button>

        <a href="/" class="px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/15">
          ๐ฌ๐ง English
        </a>
        <a href="/ar/" class="px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/15">
          ๐ฆ๐ช ุงูุนุฑุจูุฉ
        </a>

        <a href="tel:+971554637045" class="px-3 py-2 rounded-xl bg-emerald-500 text-black font-semibold hover:opacity-90">
          +971 55 463 7045
        </a>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section id="hero" class="max-w-7xl mx-auto px-4 py-12 grid md:grid-cols-2 gap-10 items-center">
    <div>
      <h2 class="text-5xl font-extrabold mb-4 leading-tight">ุชุงุฑูุง ููุชุงุฒ.<br><span class="text-emerald-400">ฺฉูุช ุงูุงุฑุงุช.</span></h2>
      <p class="text-lg text-neutral-300 mb-6">ุงุณููู ุงูุทุจู ุชุงุฑูุง ุฏุฑุฌูโฺฉ ุฑุง ุฏุฑ ุณุฑุงุณุฑ ุงูุงุฑุงุช ุนุฑุถู ูโฺฉูุฏ. ููฺฉุงุฑ ุจุง Duraturnุ Bridgestone ู Firemax ุงููุ ุขุฑุงูุด ู ุงุนุชูุงุฏ ุฑุง ุชุถูู ูโฺฉูุฏ.</p>
      <a href="#shop" class="px-6 py-3 rounded-2xl brand-gradient text-black font-bold">ุฎุฑุฏ ุชุงุฑ</a>
    </div>
    <div>
      <img src="https://www.duraturntires.com/wp-content/uploads/tire-mozzo-touring-hero.png" class="rounded-2xl shadow-lg" alt="ููุง ุชุงุฑ">
    </div>
  </section>

  <!-- ABOUT -->
  <section id="about" class="max-w-7xl mx-auto px-4 py-16">
    <h2 class="text-3xl font-bold mb-4">ุชุงุฑุฎฺู ูุง</h2>
    <p class="text-neutral-300 leading-relaxed">ุงุณููู ุงูุทุจู ุงุฒ ุณุงู ฒฐฑท ุฏุฑ ุฏุจ ุจุง ูุฏู ุชุงูู ุชุงุฑูุง ุงููุ ููุฑููโุจูโุตุฑูู ู ุจุง ุนููฺฉุฑุฏ ุจุงูุง ุขุบุงุฒ ุจู ฺฉุงุฑ ฺฉุฑุฏ. ุงูุฑูุฒุ ูุง ุจู ุนููุงู ุชูุฒุนโฺฉููุฏูโุง ูุงุจู ุงุนุชูุงุฏ ุจุง ูุฌุณุชฺฉ ุฏูู ู ุฎุฏูุงุช ูุดุชุฑ ููุชุงุฒ ุดูุงุฎุชู ูโุดูู.</p>
  </section>

  <!-- MATERIALS -->
  <section id="materials" class="max-w-7xl mx-auto px-4 py-16 bg-neutral-900/50 rounded-3xl">
    <h2 class="text-3xl font-bold mb-4">ูุญุตููุงุช</h2>
    <p class="text-neutral-300 leading-relaxed mb-8">ุฎุงููุงุฏูโูุง ุงุตู ุชุงุฑูุง ุณูุงุฑุ ูุงูฺฏุงู ุญููโูููู ุณูฺฏู ู ฺฉุงุฑุจุฑุฏูุง ุตูุนุช ุฑุง ุจุฑุฑุณ ฺฉูุฏ. ูุฑ ุฑุฏู ุจุฑุง ุนููฺฉุฑุฏ ูพุงุฏุงุฑุ ุนูุฑ ููุฏ ูุงุจู ูพุดโุจู ู ุงุณุชุญฺฉุงู ููุงุณุจ ุงูุชุฎุงุจ ุดุฏู ุงุณุช.</p>
    <div class="space-y-32 md:space-y-44">
      <article id="passenger-car-tires" class="glass rounded-3xl p-6 border-white/10 scroll-mt-24">
        <h3 class="text-xl font-bold mb-3">ุชุงุฑ ุณูุงุฑ</h3>
        <p class="text-neutral-300 leading-relaxed">ุชุงุฑูุง ุณูุงุฑ ุจุฑุง ุฑุงุญุช ุฑูุฒุงููุ ุตุฏุง ฺฉู ู ุชุฑูุฒฺฏุฑ ุงูู ุฏุฑ ุณุฑุนุชโูุง ุจุงูุง ุทุฑุงุญ ุดุฏูโุงูุฏ. ูุง ุฑู ุงูฺฏููุง ุขุฌ ุจููู ุจุฑุง ฺุณุจูุฏฺฏ ุฏุฑ ุณุทุญ ุฎุณุ ููุงููุช ุบูุชุด ูุชุนุงุฏู ุจุฑุง ูุตุฑู ุณูุฎุช ฺฉูุชุฑ ู ูพุงุฏุงุฑ ุฏุฑ ุชุบุฑ ูุณุฑ ุชูุฑฺฉุฒ ุฏุงุฑู.</p>
        <div class="mt-6 space-y-4">
          <div class="max-w-md">
            <label class="text-sm font-semibold text-neutral-200">ุจุฑูุฏ ุชุงุฑ ุณูุงุฑ</label>
            <select
              x-model="passengerBrandSelection"
              @change="activePassengerBrand = passengerBrandSelection"
              class="mt-2 w-full bg-white/5 border border-white/10 rounded-xl px-3 py-2"
            >
              <option value="">ุจุฑุง ูุดุงูุฏู ูุฏูโูุง ฺฉ ุจุฑูุฏ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ</option>
              <template x-for="b in passengerBrands" :key="b.name">
                <option :value="b.name" x-text="b.name"></option>
              </template>
            </select>
          </div>

          <div x-show="passengerBrandSelection" x-transition x-cloak class="glass rounded-2xl p-5 border-white/10">
            <div class="flex flex-wrap gap-2 mb-4">
              <template x-for="b in passengerBrands" :key="b.name">
                <button
                  class="px-3 py-2 rounded-xl text-sm border border-white/10"
                  :class="activePassengerBrand === b.name ? 'bg-emerald-400 text-black font-semibold' : 'bg-white/5 text-neutral-200 hover:bg-white/10'"
                  @click="activePassengerBrand = b.name; passengerBrandSelection = b.name"
                  x-text="b.name"
                ></button>
              </template>
            </div>

            <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4" x-show="passengerBrandModels(activePassengerBrand).length">
              <template x-for="m in passengerBrandModels(activePassengerBrand)" :key="m.name">
                <article class="rounded-2xl overflow-hidden bg-black/30 border border-white/10">
                  <img :src="m.img" :alt="m.name" class="w-full h-36 object-cover" />
                  <div class="p-3 space-y-1">
                    <h4 class="font-semibold" x-text="m.name"></h4>
                    <p class="text-xs text-neutral-400" x-text="m.desc"></p>
                  </div>
                </article>
              </template>
            </div>
            <p class="text-sm text-neutral-400" x-show="passengerBrandSelection && !passengerBrandModels(activePassengerBrand).length">
              ููุฑุณุช ูุฏูโูุง ุจูโุฒูุฏ ุงุถุงูู ูโุดูุฏ.
            </p>
          </div>
        </div>
      </article>
      <article id="truck-bus-radial-tires" class="glass rounded-3xl p-6 border-white/10 scroll-mt-24">
        <h3 class="text-xl font-bold mb-3">ุชุงุฑ ุฑุงุฏุงู ฺฉุงููู ู ุงุชูุจูุณ</h3>
        <p class="text-neutral-300 leading-relaxed">ุชุงุฑูุง ุฑุงุฏุงู ฺฉุงููู ู ุงุชูุจูุณ ุจุฑุง ูพูุงุด ุทููุงู ู ุชุญูู ุจุงุฑ ุจุงูุง ุณุงุฎุชู ุดุฏูโุงูุฏ. ุณุงุฎุชุงุฑ ุฑุงุฏุงู ูููุงุฏุ ฺฉูุชุฑู ุญุฑุงุฑุชุ ุทูู ุนูุฑ ุขุฌ ู ุงูฺฉุงู ุจุงุฒุณุงุฒ ุฑุง ุจูุจูุฏ ูโุฏูุฏ ู ูุฒูู ูุฑ ฺฉูููุชุฑ ุฑุง ฺฉุงูุด ูโุฏูุฏ.</p>
      </article>
      <article id="otr-tires" class="glass rounded-3xl p-6 border-white/10 scroll-mt-24">
        <h3 class="text-xl font-bold mb-3">ุชุงุฑ OTR</h3>
        <p class="text-neutral-300 leading-relaxed">ุชุงุฑูุง OTR (ุฎุงุฑุฌ ุฌุงุฏูโุง) ุจุฑุง ูุงุดูโุขูุงุช ุณูฺฏู ุฏุฑ ูุนุฏู ู ูพุฑูฺูโูุง ุนูุฑุงู ุทุฑุงุญ ุดุฏูโุงูุฏ. ุฏูุงุฑูโูุง ููุงููุ ุนูู ุขุฌ ุจุงูุง ู ุชุฑฺฉุจุงุช ุถุฏุจุฑุดุ ุนูุฑ ููุฏ ุฑุง ุฏุฑ ูุญุทโูุง ุณุฎุช ุงูุฒุงุด ูโุฏูุฏ.</p>
      </article>
      <article id="truck-bus-bias-tires" class="glass rounded-3xl p-6 border-white/10 scroll-mt-24">
        <h3 class="text-xl font-bold mb-3">ุชุงุฑ ุจุงุงุณ ฺฉุงููู ู ุงุชูุจูุณ</h3>
        <p class="text-neutral-300 leading-relaxed">ุชุงุฑูุง ุจุงุงุณ ููฺูุงู ุจุฑุง ูุณุฑูุง ููุทููโุง ู ุณุทูุญ ูุงูููุงุฑ ุงูุชุฎุงุจ ูโุดููุฏ. ุณุงุฎุชุงุฑ ฺูุฏูุงูุ ููุงููุช ุฌุงูุจ ุจุงูุง ุงุฌุงุฏ ูโฺฉูุฏ ู ุจุฑุง ุดุฑุงุท ุฏุดูุงุฑ ู ุณุฑุนุชโูุง ูพุงู ููุงุณุจ ุงุณุช.</p>
      </article>
    </div>
  </section>

  <!-- HQ -->
  <section id="hq" class="max-w-7xl mx-auto px-4 py-16">
    <h2 class="text-3xl font-bold mb-4">ุฏูุชุฑ ูุฑฺฉุฒ ู ุงูฺฉุงูุงุช</h2>
    <p class="text-neutral-300 leading-relaxed">ุฏูุชุฑ ูุฑฺฉุฒ ูุง ุฏุฑ ุฏุจุ ูุฑฺฉุฒ ุนููุงุช ูุฌุณุชฺฉ ู ูุฏุฑุช ูุงุฑุฏุงุช ุงุณุช. ุจุง ูุฑุงฺฉุฒ ูพุดุชุจุงู ุฏุฑ ุดุงุฑุฌู ู ุฑุงุณโุงูุฎููุ ุชูุฒุน ุณุฑุน ู ุฑุฏุงุจ ููุฌูุฏ ุฑุง ุชุถูู ูโฺฉูู.</p>
  </section>

  <!-- IMPORTS -->
  <section id="imports" class="max-w-7xl mx-auto px-4 py-16 bg-neutral-900/50 rounded-3xl">
    <h2 class="text-3xl font-bold mb-4">ูุงุฑุฏุงุช ุฌูุงู</h2>
    <p class="text-neutral-300 leading-relaxed">ุงุฒ ุชููุฏฺฉููุฏฺฏุงู ุชุงุฏุดุฏู ุฏุฑ ฺุงูพูุ ฺู ู ุชุงููุฏ ุชุงูู ูโฺฉูู ู ุจุง ฺฉุงุฑุฎุงููโูุง Duraturnุ Bridgestone ู Firemax ููฺฉุงุฑ ูุฒุฏฺฉ ุฏุงุฑู. ูุฑ ูุญูููู ุจุง ฺฉูุชุฑูโูุง ูุงุฒู ูุงุฑุฏ ฺฉุดูุฑ ูโุดูุฏ.</p>
  </section>

  <!-- SHIPPING -->
  <section id="shipping" class="max-w-7xl mx-auto px-4 py-16">
    <h2 class="text-3xl font-bold mb-4">ุงุฑุณุงู ู ูุตุจ</h2>
    <p class="text-neutral-300 leading-relaxed">ุงุฑุณุงู ุณุฑุน ุจู ุชูุงู ุงูุงุฑุงุช. ุงูฺฉุงู ุฏุฑุงูุช ุญุถูุฑุ ูุตุจ ุฏุฑ ูุญู ุง ุงุฑุณุงู ูุณุชูู ุจุฑุง ูุงูฺฏุงูโูุง ูุฑุงูู ุงุณุช. ุจุง ูุฑุงฺฉุฒ ุฎุฏูุงุช ููฺฉุงุฑ ุฏุงุฑู ุชุง ูุตุจ ุฏุฑ ููุงู ุฑูุฒ ุงูุฌุงู ุดูุฏ.</p>
  </section>

  <!-- BRANDS -->
  <section id="brands" class="max-w-7xl mx-auto px-4 py-20 bg-neutral-900/40 rounded-3xl">
    <div class="flex items-end justify-between gap-4 mb-8">
      <div>
        <h2 class="text-3xl font-extrabold">ุจุฑูุฏูุง</h2>
        <p class="text-neutral-400">ุจุฑูุฏูุง ููฺฉุงุฑ ุฑุง ุจุจูุฏ ู ุณุฑุน ุงุณุชุนูุงู ฺฉูุฏ.</p>
      </div>
    </div>

    <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-5">
      <template x-for="b in brands" :key="b.name">
        <article class="glass rounded-3xl overflow-hidden border-white/10">
          <div class="bg-black/30 p-4 h-32 flex items-center justify-center">
            <img :src="b.img" :alt="b.name + ' logo'" class="max-h-24 object-contain" />
          </div>
          <div class="p-4 space-y-3">
            <div class="flex items-center justify-between gap-2">
              <h3 class="font-bold text-lg" x-text="b.name"></h3>
              <span class="text-xs px-2 py-1 rounded-full bg-white/10" x-text="brandProductCount(b.name) + ' ูุญุตูู'"></span>
            </div>
            <p class="text-neutral-300 text-sm" x-text="b.desc"></p>
            <button class="w-full px-4 py-2 rounded-xl brand-gradient text-black font-bold hover:opacity-90" @click="sendBrandInquiry(b.name)">
              ุงุฑุณุงู ุงุณุชุนูุงู
            </button>
          </div>
        </article>
      </template>
    </div>
  </section>

  <!-- INTRODUCTION EMAIL -->
  <section id="intro" class="max-w-7xl mx-auto px-4 py-16 bg-neutral-900/40 rounded-3xl">
    <h2 class="text-3xl font-bold mb-4">ุฏุฑุงูุช ุงูู ูุนุฑู</h2>
    <p class="text-neutral-300 mb-6">ุงุทูุงุนุงุช ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ ุชุง ฺฉ ุงูู ูุนุฑู ุญุฑููโุง ุฏุฑุงูุช ฺฉูุฏ. ฺฉ ูุณุฎู ุจุฑุง ุดูุง ู ฺฉ ูุณุฎู ุจุฑุง ูุง ุงุฑุณุงู ูโุดูุฏ.</p>
    <form @submit.prevent="sendIntro" class="space-y-4 max-w-xl">
      <input required x-model="intro.name" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="ูุงู ู ูุงู ุฎุงููุงุฏฺฏ"/>
      <input required x-model="intro.email" type="email" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="ุงูู"/>
      <input required x-model="intro.phone" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="ุดูุงุฑู ุชูุงุณ"/>
      <button class="px-6 py-3 rounded-2xl brand-gradient text-black font-bold">ุงุฑุณุงู ุงูู ูุนุฑู</button>
      <p x-show="introSuccess" class="text-emerald-400 text-sm mt-1">โ ุงูู ุจุง ููููุช ุงุฑุณุงู ุดุฏ!</p>
      <p x-show="introError" class="text-red-400 text-sm mt-1" x-text="introError"></p>
    </form>
  </section>

  <!-- SHOP -->
  <section id="shop" class="max-w-7xl mx-auto px-4 py-20">
    <div class="flex items-end justify-between gap-4 mb-6">
      <div>
        <h2 class="text-3xl font-extrabold">ูุฑูุดฺฏุงู ุชุงุฑ</h2>
        <p class="text-neutral-400">ุฌุณุชุฌูุ ููุชุฑ ุจุฑูุฏุ ุงูุฒูุฏู ุจู ุณุจุฏ ู ุซุจุช ุณูุงุฑุด ุขุฒูุงุด.</p>
      </div>
      <div class="flex gap-2">
        <select x-model="selectedCurrency" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2">
          <option value="USD">ุฏูุงุฑ ุขูุฑฺฉุง ($)</option>
          <option value="AED">ุฏุฑูู ุงูุงุฑุงุช (ุฏ.ุฅ)</option>
        </select>
        <select x-model="filters.brand" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2">
          <option value="">ููู ุจุฑูุฏูุง</option>
          <option>Duraturn</option>
          <option>Bridgestone</option>
          <option>Firemax</option>
        </select>
        <input x-model="filters.query" type="search" placeholder="ุฌุณุชุฌู ุณุงุฒโฆ ูุซูุงู 205/55R16" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 placeholder:text-neutral-500" />
      </div>
    </div>

    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-5">
      <template x-for="p in filteredProducts()" :key="p.id">
        <article class="glass rounded-3xl overflow-hidden shine border-white/10">
          <img :src="p.img" :alt="p.name" class="w-full h-48 object-contain bg-black/30"/>
          <div class="p-4 space-y-2">
            <div class="flex items-center justify-between gap-2">
              <h3 class="font-bold" x-text="p.name"></h3>
              <span class="text-xs px-2 py-1 rounded-full bg-white/10" x-text="p.brand"></span>
            </div>
            <p class="text-neutral-300 text-sm" x-text="p.desc"></p>
            
            <!-- Quick Questions Section (Persian) -->
            <div class="pt-2 border-t border-white/10">
              <div class="flex items-center justify-between mb-2">
                <span class="text-xs font-semibold text-neutral-400">ูพุฑุณุดโูุง ุณุฑุน</span>
                <button 
                  @click="refreshProductQuestions(p)" 
                  class="text-xs px-2 py-1 rounded-lg bg-white/5 hover:bg-white/10 text-neutral-300"
                  title="ุชุงุฒูโุณุงุฒ ูพุฑุณุดโูุง">
                  โป
                </button>
              </div>
              <div class="space-y-1">
                <template x-for="(q, idx) in getProductQuestions(p)" :key="p.id + '-' + idx">
                  <button 
                    @click="openChatWithQuestion(q, p)"
                    class="w-full text-right text-xs px-2 py-1.5 rounded-lg bg-white/5 hover:bg-teal-500/20 text-neutral-300 hover:text-teal-300 transition-colors"
                    x-text="q">
                  </button>
                </template>
              </div>
            </div>
            
            <div class="flex items-center justify-between pt-2">
              <div>
                <div class="text-lg font-extrabold" x-text="formatPrice(p.price)"></div>
                <div class="text-xs text-neutral-400" x-text="p.size"></div>
              </div>
              <button class="px-4 py-2 rounded-xl brand-gradient text-black font-bold hover:opacity-90" @click="addToCart(p)">ุงูุฒูุฏู</button>
            </div>
          </div>
        </article>
      </template>
    </div>
  </section>

  <!-- CONTACT -->
  <section id="contact" class="max-w-7xl mx-auto px-4 py-20">
    <h2 class="text-3xl font-bold mb-6">ุชูุงุณ ุจุง ูุง</h2>
    <form @submit.prevent="sendContact" class="space-y-4 max-w-xl">
      <input required x-model="contact.name" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="ูุงู ุดูุง"/>
      <input required x-model="contact.email" type="email" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="ุงูู ุดูุง"/>
      <textarea required x-model="contact.message" rows="4" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="ูพุงู ุดูุง"></textarea>
      <button class="px-6 py-3 rounded-2xl brand-gradient text-black font-bold">ุงุฑุณุงู ูพุงู</button>
    </form>
  </section>

  <!-- FOOTER -->
  <footer class="border-t border-white/10 text-neutral-400 text-sm text-center py-6">
    ยฉ <span x-text="new Date().getFullYear()"></span> Aslama Alteeba. ฺฉูู ุญููู ูุญููุธ ุงุณุช.
  </footer>

  <!-- CART DRAWER -->
  <div class="fixed inset-0 z-50" x-show="cartOpen" x-transition>
    <div class="absolute inset-0 bg-black/60" @click="cartOpen=false"></div>
    <aside class="absolute left-0 top-0 bottom-0 w-full max-w-md bg-neutral-900 border-r border-white/10 p-5 overflow-y-auto">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-extrabold">ุณุจุฏ ุฎุฑุฏ ุดูุง</h3>
        <button class="p-2 rounded-lg bg-white/5" @click="cartOpen=false">โ</button>
      </div>

      <template x-if="cart.length===0">
        <p class="text-neutral-400">ุณุจุฏ ุฎุฑุฏ ุฎุงู ุงุณุช.</p>
      </template>

      <div class="space-y-3">
        <template x-for="(item, idx) in cart" :key="item.id + '-' + idx">
          <div class="flex gap-3 items-center glass rounded-2xl p-3">
            <img :src="item.img" :alt="item.name" class="w-16 h-16 rounded-xl object-contain bg-black/30"/>
            <div class="flex-1">
              <div class="font-semibold" x-text="item.name"></div>
              <div class="text-xs text-neutral-400" x-text="item.size + ' โข ' + item.brand"></div>
              <div class="text-sm" x-text="formatPrice(item.price)"></div>
            </div>
            <div class="flex items-center gap-2">
              <button class="px-2 py-1 bg-white/10 rounded" @click="item.qty = Math.max(1, item.qty-1)">-</button>
              <span x-text="item.qty"></span>
              <button class="px-2 py-1 bg-white/10 rounded" @click="item.qty++">+</button>
              <button class="px-2 py-1 bg-white/10 rounded" title="ุญุฐู" @click="cart.splice(idx,1)">ร</button>
            </div>
          </div>
        </template>
      </div>

      <div class="mt-6 p-4 glass rounded-2xl space-y-2">
        <div class="flex items-center justify-between text-sm">
          <span>ุฌูุน ุฌุฒุก</span>
          <span x-text="formatPrice(subtotal())"></span>
        </div>
        <div class="flex items-center justify-between text-sm text-neutral-400">
          <span>ูุงูุงุช (ตูช ุขุฒูุงุด)</span>
          <span x-text="formatPrice(subtotal()*0.05)"></span>
        </div>
        <div class="flex items-center justify-between font-bold pt-1">
          <span>ุฌูุน ฺฉู</span>
          <span x-text="formatPrice(subtotal()*1.05)"></span>
        </div>
      </div>

      <form class="mt-6 space-y-3" @submit.prevent="placeOrder()">
        <h4 class="font-bold">ุซุจุช ุณูุงุฑุด</h4>
        <input required x-model="checkout.name" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="ูุงู ฺฉุงูู"/>
        <input required x-model="checkout.email" type="email" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="ุงูู ุจุฑุง ุชุงุฏ"/>
        <input x-model="checkout.phone" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="ุดูุงุฑู ุชูุงุณ (ุงุฎุชุงุฑ)"/>
        <input x-model="checkout.vehicle" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="ุฎูุฏุฑู (ุงุฎุชุงุฑ)"/>
        <button class="w-full px-5 py-3 rounded-2xl brand-gradient text-black font-bold" :disabled="cart.length===0">ุซุจุช ุณูุงุฑุด ุขุฒูุงุด</button>
        <p class="text-xs text-neutral-400">ูพุณ ุงุฒ ุซุจุชุ ุฏู ุงูู ุงุฑุณุงู ูโุดูุฏ: ฺฉ ุจุฑุง ูุง ู ฺฉ ุจุฑุง ุดูุง.</p>
      </form>
    </aside>
  </div>

  
      </div>
    </div>
  </div>

  <!-- WHATSAPP FLOAT BUTTON (ALWAYS VISIBLE) -->
  <a
    href="https://wa.me/971554637045?text=Hello%20Aslama%20Alteeba%2C%20I%20would%20like%20to%20inquire%20about%20tires."
    class="fixed bottom-5 right-5 z-50 px-4 py-3 rounded-2xl bg-emerald-500 text-black font-extrabold shadow-lg hover:opacity-90"
    aria-label="WhatsApp"
    target="_blank"
    rel="noopener"
  >
    ูุงุชุณุงูพ
  </a>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    const EMAILJS_PUBLIC_KEY = "qkXfa4_PMbGhuWHaX";
    const EMAILJS_SERVICE_ID = "service_hhs4z1i";
    const EMAILJS_TEMPLATE_ID = "template_2djz9zc";   // orders + contact + brand inquiries
    const EMAILJS_INTRO_TEMPLATE = "template_efwbezh"; // introduction email

    if (EMAILJS_PUBLIC_KEY) emailjs.init({ publicKey: EMAILJS_PUBLIC_KEY });

    function appState(){
      return {
        cartOpen:false,
        filters:{brand:'', query:''},
        passengerBrandSelection:'',
        activePassengerBrand:'',
        contact:{name:'',email:'',message:''},
        checkout:{name:'',email:'',phone:'',vehicle:''},
        intro:{name:'',email:'',phone:''},
        introSuccess:false,
        introError:'',
        chatOpen:false,
        chatInput:'',
        chatLoading:false,
        chatError:'',
        chatMessages:[
          {role:'assistant', content:'ุจู Aslama Alteeba ุฎูุด ุขูุฏุฏ. ุฏุฑุจุงุฑู ุชุงุฑุ ุณุงุฒ ุง ููุฌูุฏ ฺู ฺฉูฺฉ ู ุชูุงูู ุงูุฌุงู ุฏููุ'}
        ],
        
        // Currency conversion
        selectedCurrency: 'USD',
        exchangeRates: { USD: 1, AED: 3.67 },
        currencySymbols: { USD: '$', AED: 'ุฏ.ุฅ' },

        brands:[
          {name:'Firemax', img:'https://i.postimg.cc/nrLrwP86/firemax-logo-e-motors-ru-removebg-preview.png', desc:'ูุญุตููุงุช ุงูุชุตุงุฏ ุจุฑุง ุณูุงุฑ ู SUV.'},
          {name:'Duraturn', img:'https://i.postimg.cc/ZKGYrRq1/4h-HO1KRF0AYc-JDu3S1nl0w3a0n-OYIt-SV0vrue-CTf-png.webp', desc:'ฺฉูุช ููุฑููโุจูโุตุฑูู ุจุง ฺฏุฒููโูุง ุชูุฑูฺฏ ู A/T.'},
          {name:'Haida', img:'https://i.postimg.cc/yNYNNGxd/haidatireb.webp', desc:'ุชุงุฑูุง ูุงุจู ุงุนุชูุงุฏ ุจุง ุฏูุงู ููุงุณุจ.'},
          {name:'Vikrant', img:'https://i.postimg.cc/vZXQCvzS/Vikrant-Tyres-Logo.jpg', desc:'ุชุงุฑูุง ุจุฑุง ุนููฺฉุฑุฏ ูพุงุฏุงุฑ ู ุงุณุชูุงุฏู ุฑูุฒูุฑู.'}
        ],

        passengerBrands:[
          {
            name:'Firemax',
            models:[
              {name:'FM601', img:'https://placehold.co/600x400?text=Firemax+FM601', desc:'ุชุตูุฑ ูููุช ุชุง ุงุฑุณุงู ุนฺฉุณ ุฑุณู.'},
              {name:'FM518', img:'https://placehold.co/600x400?text=Firemax+FM518', desc:'ุชุตูุฑ ูููุช ุชุง ุงุฑุณุงู ุนฺฉุณ ุฑุณู.'},
              {name:'POTENTIA SPORT 2', img:'https://placehold.co/600x400?text=POTENTIA+SPORT+2', desc:'ุชุตูุฑ ูููุช ุชุง ุงุฑุณุงู ุนฺฉุณ ุฑุณู.'}
            ]
          },
          {
            name:'Kpatos',
            models:[
              {name:'ุจู ุฒูุฏ', img:'https://placehold.co/600x400?text=Coming+Soon', desc:'ููุฑุณุช ูุญุตููุงุช ุจูโุฒูุฏ ุงุถุงูู ูโุดูุฏ.'}
            ]
          },
          {
            name:'Dovroad',
            models:[
              {name:'ุจู ุฒูุฏ', img:'https://placehold.co/600x400?text=Coming+Soon', desc:'ููุฑุณุช ูุญุตููุงุช ุจูโุฒูุฏ ุงุถุงูู ูโุดูุฏ.'}
            ]
          },
          {
            name:'Haida',
            models:[
              {name:'ุจู ุฒูุฏ', img:'https://placehold.co/600x400?text=Coming+Soon', desc:'ููุฑุณุช ูุญุตููุงุช ุจูโุฒูุฏ ุงุถุงูู ูโุดูุฏ.'}
            ]
          },
          {
            name:'Neolin',
            models:[
              {name:'ุจู ุฒูุฏ', img:'https://placehold.co/600x400?text=Coming+Soon', desc:'ููุฑุณุช ูุญุตููุงุช ุจูโุฒูุฏ ุงุถุงูู ูโุดูุฏ.'}
            ]
          },
          {
            name:'Duraturn',
            models:[
              {name:'ุจู ุฒูุฏ', img:'https://placehold.co/600x400?text=Coming+Soon', desc:'ููุฑุณุช ูุญุตููุงุช ุจูโุฒูุฏ ุงุถุงูู ูโุดูุฏ.'}
            ]
          }
        ],

        products:[
          {id:'dur-1', brand:'Duraturn', name:'Duraturn Mozzo Touring', size:'205/55R16', price:79.99, img:'https://www.duraturntires.com/wp-content/uploads/tire-mozzo-touring-hero.png', desc:'ุฑุงุญุช ฺูุงุฑูุตู ุจุง ุขุฌ ุจููู.'},
          {id:'bri-1', brand:'Bridgestone', name:'Bridgestone WeatherPeak', size:'225/45R17', price:129.99, img:'https://cdn.pneusecono.ca/images/produits/Bridgestone-Weatherpeak.jpg', desc:'ุงุนุชูุงุฏ ุฏุฑ ุจุงุฑุงู ู ุจุฑู ุณุจฺฉุ ูุฑู ู ุฏูู.'},
          {id:'fir-1', brand:'Firemax', name:'Firemax FM501', size:'235/75R15', price:69.99, img:'https://fdflex.com/wp-content/uploads/2024/01/FM501_2.png', desc:'ุชุงุฑ SUV ุงูุชุตุงุฏ ุจุง ูพุงุฏุงุฑ ุฎูุจ.'},
          {id:'dur-2', brand:'Duraturn', name:'Duraturn Travia A/T', size:'265/70R16', price:92.50, img:'https://cdn11.bigcommerce.com/s-e8i94i2k1a/images/stencil/1280x1280/products/58714/844891/duraturn-travia-at-b-aaa-1__48494.1719256293.jpg?c=2', desc:'ฺูุฏููุธูุฑู ุจุฑุง ุฎูุฏุฑููุง ุขูุฑูุฏ.'},
          {id:'bri-2', brand:'Bridgestone', name:'Bridgestone Dueler A/T Ascent', size:'275/60R20', price:189.00, img:'https://m.media-amazon.com/images/I/9116emC8QiL._AC_UF350,350_QL80_.jpg', desc:'ฺุณุจูุฏฺฏ ุขูุฑูุฏ ุจุง ุฑุงุญุช ุฌุงุฏูโุง.'},
          {id:'fir-2', brand:'Firemax', name:'Firemax FM316', size:'205/55R16', price:58.00, img:'https://www.tiremaxx.ca/public/upload/product/pattern_rc-upload-1688577203434-12.webp', desc:'ุชุงุฑ ุณูุงุฑ ุงูุชุตุงุฏ.'}
        ],

        cart:[],

        // Question generation templates (Persian)
        questionTemplates: {
          intents: [
            'ุขุง {subject} ุจุฑุง',
            'ฺฺฏููู {subject} ุฏุฑ',
            'ุขุง {subject} ูโุชูุงูุฏ ุจุง',
            'ุขุง {subject} ููุงุณุจ ุงุณุช ุจุฑุง',
            'ุนููฺฉุฑุฏ {subject} ุฏุฑ'
          ],
          contexts: [
            'ุฑุงููุฏฺฏ ุฑูุฒุงูู ุฏุฑ ุงุชูุจุงู ุฏุฑ ฺฏุฑูุง ุงูุงุฑุงุช ุฎูุจ ุงุณุช',
            'ุชุฑุงูฺฉ ุดูุฑ ู ุชูููโูุง ูฺฉุฑุฑ ุฎูุจ ุนูู ูโฺฉูุฏ',
            'ุณูุฑูุง ุทููุงู ุฏุฑ ุจุงุจุงู ฺฉูุงุฑ ุจุงุฏ',
            'ุฌุงุฏูโูุง ุฎุณ ู ุจุงุฑุงูโูุง ฺฏุงูโฺฏุงู ุฎูุจ ุงุณุช',
            'ูุณุฑูุง ูุงูููุงุฑ ู ุฎุงฺฉ ฺฉูุงุฑ ุจุงุฏ',
            'ุดุฑุงุท ฺฏุฑู ุชุงุจุณุชุงู ุฎูุจ ุนูู ูโฺฉูุฏ',
            'ุงุณุชูุงุฏู ุชุฑฺฉุจ ุฏุฑ ุดูุฑ ู ุงุชูุจุงู ููุงุณุจ ุงุณุช'
          ],
          subjects: [] // Generated dynamically per product
        },
        
        // Store generated questions per product
        productQuestions: {},

        async init(){
          const saved = localStorage.getItem('aa_cart');
          if (saved) this.cart = JSON.parse(saved);
          this.$watch('cart', v => localStorage.setItem('aa_cart', JSON.stringify(v)));
          
          // Load saved currency preference
          const savedCurrency = localStorage.getItem('aa_currency');
          if (savedCurrency && ['USD', 'AED'].includes(savedCurrency)) {
            this.selectedCurrency = savedCurrency;
          }
          this.$watch('selectedCurrency', v => localStorage.setItem('aa_currency', v));
          
          // Fetch exchange rates
          await this.fetchExchangeRates();
        },
        
        async fetchExchangeRates(){
          try {
            const response = await fetch('/api/exchange-rates');
            const data = await response.json();
            if (data.rates) {
              this.exchangeRates = data.rates;
            }
          } catch (err) {
            console.error('Failed to fetch exchange rates:', err);
            // Keep using fallback rates already set
          }
        },
        
        convertPrice(usdPrice){
          if (this.selectedCurrency === 'USD') {
            return usdPrice;
          } else if (this.selectedCurrency === 'AED') {
            return usdPrice * this.exchangeRates.AED;
          }
          return usdPrice;
        },
        
        formatPrice(usdPrice){
          const converted = this.convertPrice(usdPrice);
          const symbol = this.currencySymbols[this.selectedCurrency] || '$';
          // AED and USD both use 2 decimal places
          return `${symbol}${converted.toFixed(2)}`;
        },

        brandProductCount(brandName){
          return this.products.filter(p => p.brand === brandName).length;
        },

        passengerBrandModels(brandName){
          const brand = this.passengerBrands.find(b => b.name === brandName);
          return brand ? brand.models : [];
        },

        filteredProducts(){
          return this.products.filter(p => {
            const brandMatch = !this.filters.brand || p.brand === this.filters.brand;
            const q = this.filters.query.trim().toLowerCase();
            const queryMatch = !q || (p.name + ' ' + p.size).toLowerCase().includes(q);
            return brandMatch && queryMatch;
          });
        },

        addToCart(p){
          const existing = this.cart.find(i => i.id === p.id);
          if (existing) existing.qty++;
          else this.cart.push({...p, qty:1});
          this.cartOpen = true;
        },

        subtotal(){
          return this.cart.reduce((sum, i) => sum + i.price * i.qty, 0);
        },

        // Generate product subject for questions (Persian)
        getProductSubject(product){
          // Use brand + model/name if available, otherwise "ุงู ุชุงุฑ"
          if (product.brand && product.name) {
            const modelName = product.name.replace(product.brand, '').trim();
            return modelName ? `${product.brand} ${modelName}` : product.brand;
          }
          return 'ุงู ุชุงุฑ';
        },

        // Generate 3 unique questions for a product
        generateQuestions(product){
          const subject = this.getProductSubject(product);
          const subjectWithSize = product.size ? `${subject} (${product.size})` : subject;
          
          // Create pool of all possible combinations
          const allCombinations = [];
          this.questionTemplates.intents.forEach(intent => {
            this.questionTemplates.contexts.forEach(context => {
              allCombinations.push({
                intent,
                context,
                question: intent.replace('{subject}', subjectWithSize) + ' ' + context + 'ุ'
              });
            });
          });
          
          // Shuffle and pick 3 unique combinations
          const shuffled = allCombinations.sort(() => Math.random() - 0.5);
          const selected = shuffled.slice(0, 3);
          
          // Ensure no immediate repetition by checking if same intent used twice
          const intents = selected.map(s => s.intent);
          if (intents[0] === intents[1] || intents[1] === intents[2]) {
            // Reshuffle if we have adjacent duplicates
            return this.generateQuestions(product);
          }
          
          return selected.map(s => s.question);
        },

        // Get or generate questions for a product
        getProductQuestions(product){
          if (!this.productQuestions[product.id]) {
            this.productQuestions[product.id] = this.generateQuestions(product);
          }
          return this.productQuestions[product.id];
        },

        // Refresh questions for a specific product
        refreshProductQuestions(product){
          this.productQuestions[product.id] = this.generateQuestions(product);
        },

        // Open AI chat with pre-filled question and product context
        openChatWithQuestion(question, product){
          const priceInfo = this.formatPrice(product.price);
          const context = `ุจุฑุง ูุญุตูู ${this.getProductSubject(product)}${product.size ? ' (' + product.size + ')' : ''}${product.desc ? 'ุ ' + product.desc : ''} - ููุช: ${priceInfo}`;
          const fullMessage = `${question}\n\n[ุงุทูุงุนุงุช ูุญุตูู: ${context}]`;
          
          // Open the AI chat widget
          const chatBtn = document.querySelector('.ai-chat-btn');
          const chatBox = document.querySelector('.ai-chat-box');
          if (chatBtn && chatBox) {
            chatBox.style.display = 'flex';
            chatBox.style.flexDirection = 'column';
            
            // Pre-fill the input
            const chatInput = chatBox.querySelector('.ai-chat-input');
            if (chatInput) {
              chatInput.value = fullMessage;
              chatInput.focus();
            }
          }
        },

        // send two emails with the standard template (orders/contact/brand inquiries)
        async sendTwoEmails(params){
          await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {...params, to_email: 'Ilimot2012@gmail.com'});
          await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {...params, to_email: params.customer_email || params.from_email});
        },

        // BRAND INQUIRY
        async sendBrandInquiry(brandName){
          const list = this.products.filter(p => p.brand === brandName);
          const lines = list.length
            ? list.map(p => `โข ${p.name} (${p.size}) โ $${p.price.toFixed(2)}`).join('\n')
            : 'ูุญุตูู ุจุฑุง ุงู ุจุฑูุฏ ุซุจุช ูุดุฏู ุงุณุช.';

          const params = {
            subject_line: `ุงุณุชุนูุงู ุจุฑูุฏ โ ${brandName}`,
            from_name: 'ุจุงุฒุฏุฏฺฉููุฏู ุณุงุช',
            from_email: 'no-reply@aslamalteeba.netlify.app',
            customer_email: 'no-reply@aslamalteeba.netlify.app',
            message: `ุฏุฑุฎูุงุณุช ุงุทูุงุนุงุช ุฏุฑุจุงุฑู ${brandName}.`,
            brand_name: brandName,
            brand_products: lines
          };

          try {
            await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {...params, to_email: 'Ilimot2012@gmail.com'});
            alert('โ ุงุณุชุนูุงู ุงุฑุณุงู ุดุฏ. ุจู ุฒูุฏ ุจุง ุดูุง ุชูุงุณ ูโฺฏุฑู.');
          } catch (err){
            console.error(err);
            alert('โ ุฎุทุง ุฏุฑ ุงุฑุณุงู ุงุณุชุนูุงู: ' + (err?.text || err?.message || 'ูุงูุดุฎุต'));
          }
        },

        // CONTACT
        async sendContact(){
          const params = {
            subject_line: 'ุชูุงุณ โ Aslama Alteeba',
            from_name: this.contact.name,
            from_email: this.contact.email,
            customer_email: this.contact.email,
            message: this.contact.message
          };
          try {
            await this.sendTwoEmails(params);
            alert('โ ูพุงู ุงุฑุณุงู ุดุฏ!');
            this.contact = {name:'',email:'',message:''};
          } catch (err){
            console.error(err);
            alert('โ ุฎุทุง ุฏุฑ ุงุฑุณุงู ูพุงู: ' + (err?.text || err?.message || 'ูุงูุดุฎุต'));
          }
        },

        // ORDER
        async placeOrder(){
          if (this.cart.length===0) return;
          const lines = this.cart.map(i => `${i.qty}x ${i.name} (${i.size}) โ $${(i.price*i.qty).toFixed(2)}`).join('\n');
          const sub = this.subtotal(), vat=sub*0.05, total=sub+vat;
          const params = {
            subject_line: `ุณูุงุฑุด โ ${this.checkout.name}`,
            from_name: this.checkout.name,
            from_email: this.checkout.email,
            customer_email: this.checkout.email,
            message: 'ุณูุงุฑุด ุฌุฏุฏ ุงุฒ ูุจโุณุงุช (ุญุงูุช ุขุฒูุงุด).',
            order_lines: lines,
            order_subtotal: `$${sub.toFixed(2)}`,
            order_vat: `$${vat.toFixed(2)}`,
            order_total: `$${total.toFixed(2)}`,
            customer_phone: this.checkout.phone || 'N/A',
            customer_vehicle: this.checkout.vehicle || 'N/A'
          };
          try {
            await this.sendTwoEmails(params);
            alert('โ ุณูุงุฑุด ุจุง ููููุช ุซุจุช ุดุฏ!');
            this.cart = [];
            this.cartOpen = false;
            this.checkout = {name:'',email:'',phone:'',vehicle:''};
          } catch(err){
            console.error(err);
            alert('โ ุฎุทุง ุฏุฑ ุซุจุช ุณูุงุฑุด: ' + (err?.text || err?.message || 'ูุงูุดุฎุต'));
          }
        },

        // INTRO EMAIL (uses dedicated template)
        async sendIntro(){
          this.introSuccess = false; this.introError = '';
          const params = {
            subject_line: 'ุฏุฑุฎูุงุณุช ูุนุฑู โ Aslama Alteeba',
            from_name: this.intro.name,
            from_email: this.intro.email,
            customer_email: this.intro.email,
            phone: this.intro.phone
          };
          try {
            await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_INTRO_TEMPLATE, {...params, to_email: 'Ilimot2012@gmail.com'});
            await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_INTRO_TEMPLATE, {...params, to_email: params.customer_email});
            this.introSuccess = true;
            this.intro = {name:'',email:'',phone:''};
          } catch(err){
            console.error(err);
            this.introError = 'ุฎุทุง: ' + (err?.text || err?.message || 'ูุงูุดุฎุต');
          }
        },

        scrollChat(){
          const el = this.$refs.chatScroll;
          if (el) el.scrollTop = el.scrollHeight;
        },

        async sendChatMessage(){
          const content = this.chatInput.trim();
          if (!content || this.chatLoading) return;
          this.chatError = '';
          this.chatMessages.push({role:'user', content});
          this.chatInput = '';
          this.chatLoading = true;
          this.$nextTick(() => this.scrollChat());
          try {
            const response = await fetch('/api/chat', {
              method: 'POST',
              headers: {'Content-Type':'application/json'},
              body: JSON.stringify({message: content})
            });
            const data = await response.json().catch(() => ({}));
            if (!response.ok) {
              throw new Error(data?.error || data?.message || 'Failed to get AI response');
            }
            const reply = (data?.reply || '').trim() || 'ูุชุดฺฉุฑู ุงุฒ ูพุฑุณุด ุดูุง. ุชู ูุง ุจู ุฒูุฏ ูพุงุณุฎ ูโุฏูุฏ.';
            this.chatMessages.push({role:'assistant', content: reply});
          } catch(err) {
            const msg = err?.message || 'ฺุช ููุดููุฏ ุฏุฑ ุญุงู ุญุงุถุฑ ุฏุฑ ุฏุณุชุฑุณ ูุณุช.';
            this.chatError = msg;
            this.chatMessages.push({role:'assistant', content: 'ูุชุฃุณูุงูู ุฏุณุชุงุฑ ููุดููุฏ ุฏุฑ ุญุงู ุญุงุถุฑ ุฏุฑ ุฏุณุชุฑุณ ูุณุช. ูุทูุงู ุจุนุฏุงู ุงูุชุญุงู ฺฉูุฏ.'});
          } finally {
            this.chatLoading = false;
            this.$nextTick(() => this.scrollChat());
          }
        }
      }
    }
  </script>
  <script src="/chat.js" defer></script>
</body>
</html>
