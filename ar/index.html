<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>أسلمة الطيبة — متجر الإطارات</title>
  <meta name="description" content="أسلمة الطيبة: مورد إطارات متميز في الإمارات. تصفح Duraturn و Bridgestone و Firemax. جودة وإرث واعتمادية." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <style>
    html,body{font-family:Tajawal,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
    .glass{backdrop-filter: blur(12px); background: rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1)}
    .brand-gradient{background:linear-gradient(135deg,#00E0A4,#32D5FF)}
    .shine{position:relative;overflow:hidden}
    .shine:after{content:"";position:absolute;inset:-120% auto auto -120%;width:60%;height:300%;transform:rotate(25deg);background:linear-gradient(90deg,transparent,rgba(255,255,255,.18),transparent);animation:shine 6s infinite}
    [x-cloak]{display:none !important}
    @keyframes shine{0%{left:-120%}60%{left:140%}100%{left:140%}}
  </style>
</head>
<body class="bg-neutral-950 text-neutral-100" x-data="appState()" x-init="init()">
  <!-- HEADER -->
  <header class="sticky top-0 z-50 glass">
    <div class="max-w-7xl mx-auto flex items-center justify-between px-4 py-3">
      <h1 class="text-xl font-extrabold tracking-tight">Aslama <span class="text-emerald-400">Alteeba</span></h1>
      <nav class="hidden md:flex gap-6 text-sm">
        <a href="#about" class="hover:text-white">من نحن</a>
        <div class="relative" x-data="{open:false}">
          <button class="hover:text-white flex items-center gap-2" aria-haspopup="true" :aria-expanded="open" @click="open = !open" @keydown.escape="open=false">
            المنتجات
            <span class="text-xs text-neutral-400">▾</span>
          </button>
          <div class="absolute right-0 top-full mt-2 w-72 rounded-2xl border border-white/10 bg-neutral-950/95 backdrop-blur p-2 shadow-xl" x-show="open" x-transition.origin.top.right @click.outside="open=false" x-cloak>
            <a href="#passenger-car-tires" class="block rounded-xl px-3 py-2 text-sm text-neutral-200 hover:bg-white/10" @click="open=false">إطارات سيارات الركاب</a>
            <a href="#truck-bus-radial-tires" class="block rounded-xl px-3 py-2 text-sm text-neutral-200 hover:bg-white/10" @click="open=false">إطارات الشاحنات والحافلات الشعاعية</a>
            <a href="#otr-tires" class="block rounded-xl px-3 py-2 text-sm text-neutral-200 hover:bg-white/10" @click="open=false">إطارات OTR</a>
            <a href="#truck-bus-bias-tires" class="block rounded-xl px-3 py-2 text-sm text-neutral-200 hover:bg-white/10" @click="open=false">إطارات الشاحنات والحافلات بايس</a>
          </div>
        </div>
        <a href="#hq" class="hover:text-white">المقر الرئيسي</a>
        <a href="#imports" class="hover:text-white">الاستيراد</a>
        <a href="#shipping" class="hover:text-white">الشحن</a>
        <a href="#brands" class="hover:text-white">العلامات التجارية</a>
        <a href="#intro" class="hover:text-white">بريد التعريف</a>
        <a href="#shop" class="hover:text-white">المتجر</a>
        <a href="#contact" class="hover:text-white">اتصل بنا</a>
      </nav>
      <div class="flex items-center gap-2">
        <button class="px-3 py-2 rounded-xl bg-white/10 border border-white/10" @click="cartOpen=true">
          سلة الشراء <span class="ml-1 text-emerald-400 font-bold" x-text="cart.length"></span>
        </button>

        <a href="/" class="px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/15">
          English
        </a>
        <a href="/fa/" class="px-3 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/15">
          فارسی
        </a>

        <a href="tel:+971554637045" class="px-3 py-2 rounded-xl bg-emerald-500 text-black font-semibold hover:opacity-90">
          +971 55 463 7045
        </a>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section id="hero" class="max-w-7xl mx-auto px-4 py-12 grid md:grid-cols-2 gap-10 items-center">
    <div>
      <h2 class="text-5xl font-extrabold mb-4 leading-tight">إطارات ممتازة.<br><span class="text-emerald-400">جودة الإمارات.</span></h2>
      <p class="text-lg text-neutral-300 mb-6">تقدم أسلمة الطيبة إطارات عالية الجودة في جميع أنحاء الإمارات. شراكات مع Duraturn و Bridgestone و Firemax تضمن السلامة والراحة والاعتمادية.</p>
      <a href="#shop" class="px-6 py-3 rounded-2xl brand-gradient text-black font-bold">تسوق الإطارات</a>
    </div>
    <div>
      <img src="https://www.duraturntires.com/wp-content/uploads/tire-mozzo-touring-hero.png" class="rounded-2xl shadow-lg" alt="عرض إطارات">
    </div>
  </section>

  <!-- ABOUT -->
  <section id="about" class="max-w-7xl mx-auto px-4 py-16">
    <h2 class="text-3xl font-bold mb-4">تاريخنا</h2>
    <p class="text-neutral-300 leading-relaxed">تأسست أسلمة الطيبة في دبي عام 2017 كمورد صغير يركز على توفير إطارات آمنة، اقتصادية، وذات أداء قوي للأسواق المحلية. على مر السنين تطورنا إلى موزع موثوق بفضل لوجستيات دقيقة ورعاية ممتازة للعملاء.</p>
  </section>

  <!-- MATERIALS -->
  <section id="materials" class="max-w-7xl mx-auto px-4 py-16 bg-neutral-900/50 rounded-3xl">
    <h2 class="text-3xl font-bold mb-4">المنتجات</h2>
    <p class="text-neutral-300 leading-relaxed mb-8">استكشف فئات المنتجات الأساسية للمركبات الخاصة، الأساطيل طويلة المدى، والاستخدامات الصناعية الثقيلة. كل فئة مختارة لتقديم أداء ثابت، تآكل متوقع، وقوة بنية موثوقة في الظروف التي صممت لها.</p>
    <div class="space-y-32 md:space-y-44">
      <article id="passenger-car-tires" class="glass rounded-3xl p-6 border-white/10 scroll-mt-24">
        <h3 class="text-xl font-bold mb-3">إطارات سيارات الركاب</h3>
        <p class="text-neutral-300 leading-relaxed">صممت إطارات سيارات الركاب للراحة اليومية، الضجيج المنخفض، والفرملة الآمنة على الطرق السريعة. تركيزنا على أنماط مداس محسنة للتماسك على الأسطح الرطبة، مقاومة تدحرج متوازنة لاستهلاك أقل للوقود، وكتل كتف ثابتة لتبديلات مسار واثقة.</p>
        <div class="mt-6 space-y-4">
          <div class="max-w-md">
            <label class="text-sm font-semibold text-neutral-200">علامات إطارات الركاب</label>
            <select
              x-model="passengerBrandSelection"
              @change="activePassengerBrand = passengerBrandSelection"
              class="mt-2 w-full bg-white/5 border border-white/10 rounded-xl px-3 py-2"
            >
              <option value="">اختر علامة لعرض الموديلات</option>
              <template x-for="b in passengerBrands" :key="b.name">
                <option :value="b.name" x-text="b.name"></option>
              </template>
            </select>
          </div>

          <div x-show="passengerBrandSelection" x-transition x-cloak class="glass rounded-2xl p-5 border-white/10">
            <div class="flex flex-wrap gap-2 mb-4">
              <template x-for="b in passengerBrands" :key="b.name">
                <button
                  class="px-3 py-2 rounded-xl text-sm border border-white/10"
                  :class="activePassengerBrand === b.name ? 'bg-emerald-400 text-black font-semibold' : 'bg-white/5 text-neutral-200 hover:bg-white/10'"
                  @click="activePassengerBrand = b.name; passengerBrandSelection = b.name"
                  x-text="b.name"
                ></button>
              </template>
            </div>

            <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4" x-show="passengerBrandModels(activePassengerBrand).length">
              <template x-for="m in passengerBrandModels(activePassengerBrand)" :key="m.name">
                <article class="rounded-2xl overflow-hidden bg-black/30 border border-white/10">
                  <img :src="m.img" :alt="m.name" class="w-full h-36 object-cover" />
                  <div class="p-3 space-y-1">
                    <h4 class="font-semibold" x-text="m.name"></h4>
                    <p class="text-xs text-neutral-400" x-text="m.desc"></p>
                  </div>
                </article>
              </template>
            </div>
            <p class="text-sm text-neutral-400" x-show="passengerBrandSelection && !passengerBrandModels(activePassengerBrand).length">
              سيتم إضافة الموديلات قريباً.
            </p>
          </div>
        </div>
      </article>
      <article id="truck-bus-radial-tires" class="glass rounded-3xl p-6 border-white/10 scroll-mt-24">
        <h3 class="text-xl font-bold mb-3">إطارات الشاحنات والحافلات الشعاعية</h3>
        <p class="text-neutral-300 leading-relaxed">بنيت إطارات الشاحنات والحافلات الشعاعية لتعظيم المسافة المقطوعة واستقرار الحمولة للأساطيل التجارية. البناء الشعاعي المدعم بالفولاذ يقلل الحرارة ويحسن عمر المداس ويتيح دورات إعادة النقش، ما يخفض التكلفة لكل كيلومتر.</p>
      </article>
      <article id="otr-tires" class="glass rounded-3xl p-6 border-white/10 scroll-mt-24">
        <h3 class="text-xl font-bold mb-3">إطارات OTR</h3>
        <p class="text-neutral-300 leading-relaxed">إطارات OTR (للعمل خارج الطرق) مخصصة للآليات الثقيلة في المحاجر ومواقع البناء والتعدين. تعطي أولوية لمقاومة القطع وعمق المداس العالي وحماية الجدار الجانبي، لضمان عمر خدمة طويل في البيئات القاسية.</p>
      </article>
      <article id="truck-bus-bias-tires" class="glass rounded-3xl p-6 border-white/10 scroll-mt-24">
        <h3 class="text-xl font-bold mb-3">إطارات الشاحنات والحافلات بايس</h3>
        <p class="text-neutral-300 leading-relaxed">لا تزال إطارات البايس خياراً مناسباً لمسارات المناطق والأسطح المتنوعة والحمولات الثقيلة بسرعات منخفضة. بنيتها المتقاطعة تعزز صلابة الجدار الجانبي ومقاومة الصدمات، ما يجعلها مناسبة للطرق الوعرة والأساطيل القديمة.</p>
      </article>
    </div>
  </section>

  <!-- HQ -->
  <section id="hq" class="max-w-7xl mx-auto px-4 py-16">
    <h2 class="text-3xl font-bold mb-4">المقر الرئيسي والمرافق</h2>
    <p class="text-neutral-300 leading-relaxed">يقع مقرنا الرئيسي في دبي كمركز عمليات اللوجستيات والتنسيق مع الشحنات والشركاء. مع مرافق في الشارقة ورأس الخيمة، نضمن توزيعاً سريعاً وتتبعاً لحظياً للمخزون.</p>
  </section>

  <!-- IMPORTS -->
  <section id="imports" class="max-w-7xl mx-auto px-4 py-16 bg-neutral-900/50 rounded-3xl">
    <h2 class="text-3xl font-bold mb-4">الاستيراد العالمي</h2>
    <p class="text-neutral-300 leading-relaxed">نستورد من مصانع معتمدة في اليابان والصين وتايلاند، مع علاقات مباشرة مع Duraturn و Bridgestone و Firemax. كل شحنة تمر بإجراءات فحص لضمان الأصالة والتتبع.</p>
  </section>

  <!-- SHIPPING -->
  <section id="shipping" class="max-w-7xl mx-auto px-4 py-16">
    <h2 class="text-3xl font-bold mb-4">الشحن والتركيب</h2>
    <p class="text-neutral-300 leading-relaxed">توصيل سريع إلى جميع إمارات الدولة. يمكن اختيار الاستلام من الموقع، التركيب في الموقع، أو الشحن المباشر لعملاء الأساطيل. نتعاون مع مراكز الخدمة لتوفير تركيب في اليوم نفسه عند الإمكان.</p>
  </section>

  <!-- BRANDS -->
  <section id="brands" class="max-w-7xl mx-auto px-4 py-20 bg-neutral-900/40 rounded-3xl">
    <div class="flex items-end justify-between gap-4 mb-8">
      <div>
        <h2 class="text-3xl font-extrabold">العلامات التجارية</h2>
        <p class="text-neutral-400">تصفح علاماتنا الشريكة وأرسل استفساراً فوراً.</p>
      </div>
    </div>

    <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-5">
      <template x-for="b in brands" :key="b.name">
        <article class="glass rounded-3xl overflow-hidden border-white/10">
          <div class="bg-black/30 p-4 h-32 flex items-center justify-center">
            <img :src="b.img" :alt="b.name + ' logo'" class="max-h-24 object-contain" />
          </div>
          <div class="p-4 space-y-3">
            <div class="flex items-center justify-between gap-2">
              <h3 class="font-bold text-lg" x-text="b.name"></h3>
              <span class="text-xs px-2 py-1 rounded-full bg-white/10" x-text="brandProductCount(b.name) + ' منتجات'"></span>
            </div>
            <p class="text-neutral-300 text-sm" x-text="b.desc"></p>
            <button class="w-full px-4 py-2 rounded-xl brand-gradient text-black font-bold hover:opacity-90" @click="sendBrandInquiry(b.name)">
              إرسال استفسار
            </button>
          </div>
        </article>
      </template>
    </div>
  </section>

  <!-- INTRODUCTION EMAIL -->
  <section id="intro" class="max-w-7xl mx-auto px-4 py-16 bg-neutral-900/40 rounded-3xl">
    <h2 class="text-3xl font-bold mb-4">الحصول على بريد تعريفي</h2>
    <p class="text-neutral-300 mb-6">أدخل بياناتك للحصول على بريد تعريفي مهني عن خدماتنا. سيتم إرسال نسخة لك ونسخة إلى بريدنا.</p>
    <form @submit.prevent="sendIntro" class="space-y-4 max-w-xl">
      <input required x-model="intro.name" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="الاسم الكامل"/>
      <input required x-model="intro.email" type="email" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="البريد الإلكتروني"/>
      <input required x-model="intro.phone" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="رقم الهاتف"/>
      <button class="px-6 py-3 rounded-2xl brand-gradient text-black font-bold">إرسال البريد التعريفي</button>
      <p x-show="introSuccess" class="text-emerald-400 text-sm mt-1">✅ تم إرسال البريد بنجاح!</p>
      <p x-show="introError" class="text-red-400 text-sm mt-1" x-text="introError"></p>
    </form>
  </section>

  <!-- SHOP -->
  <section id="shop" class="max-w-7xl mx-auto px-4 py-20">
    <div class="flex items-end justify-between gap-4 mb-6">
      <div>
        <h2 class="text-3xl font-extrabold">متجر الإطارات</h2>
        <p class="text-neutral-400">ابحث، صفِ حسب العلامة، أضف إلى السلة، وأرسل طلباً تجريبياً.</p>
      </div>
      <div class="flex gap-2">
        <select x-model="filters.brand" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2">
          <option value="">كل العلامات</option>
          <option>Duraturn</option>
          <option>Bridgestone</option>
          <option>Firemax</option>
        </select>
        <input x-model="filters.query" type="search" placeholder="ابحث عن المقاس… مثل 205/55R16" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 placeholder:text-neutral-500" />
      </div>
    </div>

    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-5">
      <template x-for="p in filteredProducts()" :key="p.id">
        <article class="glass rounded-3xl overflow-hidden shine border-white/10">
          <img :src="p.img" :alt="p.name" class="w-full h-48 object-contain bg-black/30"/>
          <div class="p-4 space-y-2">
            <div class="flex items-center justify-between gap-2">
              <h3 class="font-bold" x-text="p.name"></h3>
              <span class="text-xs px-2 py-1 rounded-full bg-white/10" x-text="p.brand"></span>
            </div>
            <p class="text-neutral-300 text-sm" x-text="p.desc"></p>
            <div class="flex items-center justify-between pt-2">
              <div>
                <div class="text-lg font-extrabold" x-text="'$'+p.price.toFixed(2)"></div>
                <div class="text-xs text-neutral-400" x-text="p.size"></div>
              </div>
              <button class="px-4 py-2 rounded-xl brand-gradient text-black font-bold hover:opacity-90" @click="addToCart(p)">إضافة</button>
            </div>
          </div>
        </article>
      </template>
    </div>
  </section>

  <!-- CONTACT -->
  <section id="contact" class="max-w-7xl mx-auto px-4 py-20">
    <h2 class="text-3xl font-bold mb-6">اتصل بنا</h2>
    <form @submit.prevent="sendContact" class="space-y-4 max-w-xl">
      <input required x-model="contact.name" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="اسمك"/>
      <input required x-model="contact.email" type="email" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="بريدك الإلكتروني"/>
      <textarea required x-model="contact.message" rows="4" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="رسالتك"></textarea>
      <button class="px-6 py-3 rounded-2xl brand-gradient text-black font-bold">إرسال الرسالة</button>
    </form>
  </section>

  <!-- FOOTER -->
  <footer class="border-t border-white/10 text-neutral-400 text-sm text-center py-6">
    © <span x-text="new Date().getFullYear()"></span> Aslama Alteeba. جميع الحقوق محفوظة.
  </footer>

  <!-- CART DRAWER -->
  <div class="fixed inset-0 z-50" x-show="cartOpen" x-transition>
    <div class="absolute inset-0 bg-black/60" @click="cartOpen=false"></div>
    <aside class="absolute left-0 top-0 bottom-0 w-full max-w-md bg-neutral-900 border-r border-white/10 p-5 overflow-y-auto">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-extrabold">سلة الشراء الخاصة بك</h3>
        <button class="p-2 rounded-lg bg-white/5" @click="cartOpen=false">✕</button>
      </div>

      <template x-if="cart.length===0">
        <p class="text-neutral-400">السلة فارغة.</p>
      </template>

      <div class="space-y-3">
        <template x-for="(item, idx) in cart" :key="item.id + '-' + idx">
          <div class="flex gap-3 items-center glass rounded-2xl p-3">
            <img :src="item.img" :alt="item.name" class="w-16 h-16 rounded-xl object-contain bg-black/30"/>
            <div class="flex-1">
              <div class="font-semibold" x-text="item.name"></div>
              <div class="text-xs text-neutral-400" x-text="item.size + ' • ' + item.brand"></div>
              <div class="text-sm" x-text="'$'+item.price.toFixed(2)"></div>
            </div>
            <div class="flex items-center gap-2">
              <button class="px-2 py-1 bg-white/10 rounded" @click="item.qty = Math.max(1, item.qty-1)">-</button>
              <span x-text="item.qty"></span>
              <button class="px-2 py-1 bg-white/10 rounded" @click="item.qty++">+</button>
              <button class="px-2 py-1 bg-white/10 rounded" title="إزالة" @click="cart.splice(idx,1)">×</button>
            </div>
          </div>
        </template>
      </div>

      <div class="mt-6 p-4 glass rounded-2xl space-y-2">
        <div class="flex items-center justify-between text-sm">
          <span>الإجمالي الفرعي</span>
          <span x-text="'$'+subtotal().toFixed(2)"></span>
        </div>
        <div class="flex items-center justify-between text-sm text-neutral-400">
          <span>الضريبة (5% تجريبية)</span>
          <span x-text="'$'+(subtotal()*0.05).toFixed(2)"></span>
        </div>
        <div class="flex items-center justify-between font-bold pt-1">
          <span>الإجمالي</span>
          <span x-text="'$'+(subtotal()*1.05).toFixed(2)"></span>
        </div>
      </div>

      <form class="mt-6 space-y-3" @submit.prevent="placeOrder()">
        <h4 class="font-bold">إتمام الشراء</h4>
        <input required x-model="checkout.name" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="الاسم الكامل"/>
        <input required x-model="checkout.email" type="email" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="البريد الإلكتروني للتأكيد"/>
        <input x-model="checkout.phone" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="رقم الهاتف (اختياري)"/>
        <input x-model="checkout.vehicle" class="bg-white/5 border border-white/10 rounded-xl px-3 py-2 w-full" placeholder="المركبة (اختياري)"/>
        <button class="w-full px-5 py-3 rounded-2xl brand-gradient text-black font-bold" :disabled="cart.length===0">إرسال طلب تجريبي</button>
        <p class="text-xs text-neutral-400">سيتم إرسال بريدين: واحد لنا وواحد لك. لا حاجة لتطبيق البريد.</p>
      </form>
    </aside>
  </div>

  

      <div class="max-h-80 overflow-y-auto px-4 py-3 space-y-3" x-ref="chatScroll">
        <template x-for="(msg, idx) in chatMessages" :key="idx">
          <div class="flex" :class="msg.role === 'user' ? 'justify-end' : 'justify-start'">
            <div
              class="px-3 py-2 rounded-2xl text-sm max-w-[80%]"
              :class="msg.role === 'user' ? 'bg-emerald-500 text-black' : 'bg-white/10 text-neutral-100'"
              x-text="msg.content"
            ></div>
          </div>
        </template>

        <template x-if="chatLoading">
          <div class="flex justify-start">
            <div class="px-3 py-2 rounded-2xl text-sm bg-white/10 text-neutral-100">يكتب…</div>
          </div>
        </template>
      </div>

      <div class="border-t border-white/10 px-3 py-3 space-y-2">
        <p class="text-xs text-red-400" x-show="chatError" x-text="chatError"></p>
        <form class="flex gap-2" @submit.prevent="sendChatMessage()">
          <input
            x-model="chatInput"
            class="flex-1 bg-white/5 border border-white/10 rounded-xl px-3 py-2 text-sm text-right"
            placeholder="اكتب سؤالك..."
            :disabled="chatLoading"
          />
          <button
            class="px-4 py-2 rounded-xl brand-gradient text-black font-bold"
            :disabled="chatLoading || !chatInput.trim()"
          >
            إرسال
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- WHATSAPP FLOAT BUTTON (ALWAYS VISIBLE) -->
  <a
    href="https://wa.me/971554637045?text=Hello%20Aslama%20Alteeba%2C%20I%20would%20like%20to%20inquire%20about%20tires."
    class="fixed bottom-5 right-5 z-50 px-4 py-3 rounded-2xl bg-emerald-500 text-black font-extrabold shadow-lg hover:opacity-90"
    aria-label="WhatsApp"
    target="_blank"
    rel="noopener"
  >
    واتساب
  </a>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    const EMAILJS_PUBLIC_KEY = "qkXfa4_PMbGhuWHaX";
    const EMAILJS_SERVICE_ID = "service_hhs4z1i";
    const EMAILJS_TEMPLATE_ID = "template_2djz9zc";   // orders + contact + brand inquiries
    const EMAILJS_INTRO_TEMPLATE = "template_efwbezh"; // introduction email

    if (EMAILJS_PUBLIC_KEY) emailjs.init({ publicKey: EMAILJS_PUBLIC_KEY });

    function appState(){
      return {
        cartOpen:false,
        filters:{brand:'', query:''},
        passengerBrandSelection:'',
        activePassengerBrand:'',
        contact:{name:'',email:'',message:''},
        checkout:{name:'',email:'',phone:'',vehicle:''},
        intro:{name:'',email:'',phone:''},
        introSuccess:false,
        introError:'',
        chatOpen:false,
        chatInput:'',
        chatLoading:false,
        chatError:'',
        chatMessages:[
          {role:'assistant', content:'مرحباً بك في Aslama Alteeba. كيف يمكننا المساعدة في الإطارات أو المقاسات أو التوفر؟'}
        ],

        brands:[
          {name:'Firemax', img:'https://i.postimg.cc/nrLrwP86/firemax-logo-e-motors-ru-removebg-preview.png', desc:'تشكيلة اقتصادية لسيارات الركاب وSUV.'},
          {name:'Duraturn', img:'https://i.postimg.cc/ZKGYrRq1/4h-HO1KRF0AYc-JDu3S1nl0w3a0n-OYIt-SV0vrue-CTf-png.webp', desc:'جودة اقتصادية مع خيارات تورينغ وA/T قوية.'},
          {name:'Haida', img:'https://i.postimg.cc/yNYNNGxd/haidatireb.webp', desc:'مجموعة موثوقة تجمع بين المتانة والقيمة.'},
          {name:'Vikrant', img:'https://i.postimg.cc/vZXQCvzS/Vikrant-Tyres-Logo.jpg', desc:'إطارات لأداء ثابت واستخدام يومي.'}
        ],

        passengerBrands:[
          {
            name:'Firemax',
            models:[
              {name:'FM601', img:'https://placehold.co/600x400?text=Firemax+FM601', desc:'صورة مؤقتة حتى توفير الصورة الرسمية.'},
              {name:'FM518', img:'https://placehold.co/600x400?text=Firemax+FM518', desc:'صورة مؤقتة حتى توفير الصورة الرسمية.'},
              {name:'POTENTIA SPORT 2', img:'https://placehold.co/600x400?text=POTENTIA+SPORT+2', desc:'صورة مؤقتة حتى توفير الصورة الرسمية.'}
            ]
          },
          {name:'Kpatos', models:[]},
          {name:'Dovroad', models:[]},
          {name:'Haida', models:[]},
          {name:'Neolin', models:[]},
          {name:'Duraturn', models:[]}
        ],

        products:[
          {id:'dur-1', brand:'Duraturn', name:'Duraturn Mozzo Touring', size:'205/55R16', price:79.99, img:'https://www.duraturntires.com/wp-content/uploads/tire-mozzo-touring-hero.png', desc:'راحة طوال المواسم مع مداس محسن.'},
          {id:'bri-1', brand:'Bridgestone', name:'Bridgestone WeatherPeak', size:'225/45R17', price:129.99, img:'https://cdn.pneusecono.ca/images/produits/Bridgestone-Weatherpeak.jpg', desc:'ثقة في المطر والثلج الخفيف. نعومة تورينغ ممتازة.'},
          {id:'fir-1', brand:'Firemax', name:'Firemax FM501', size:'235/75R15', price:69.99, img:'https://fdflex.com/wp-content/uploads/2024/01/FM501_2.png', desc:'إطار SUV اقتصادي بثبات جيد على الطرق.'},
          {id:'dur-2', brand:'Duraturn', name:'Duraturn Travia A/T', size:'265/70R16', price:92.50, img:'https://cdn11.bigcommerce.com/s-e8i94i2k1a/images/stencil/1280x1280/products/58714/844891/duraturn-travia-at-b-aaa-1__48494.1719256293.jpg?c=2', desc:'قدرة متعددة للطرق الوعرة والشاحنات.'},
          {id:'bri-2', brand:'Bridgestone', name:'Bridgestone Dueler A/T Ascent', size:'275/60R20', price:189.00, img:'https://m.media-amazon.com/images/I/9116emC8QiL._AC_UF350,350_QL80_.jpg', desc:'تماسك قوي للطرق الوعرة مع راحة على الأسفلت.'},
          {id:'fir-2', brand:'Firemax', name:'Firemax FM316', size:'205/55R16', price:58.00, img:'https://www.tiremaxx.ca/public/upload/product/pattern_rc-upload-1688577203434-12.webp', desc:'إطار ركاب اقتصادي.'}
        ],

        cart:[],

        init(){
          const saved = localStorage.getItem('aa_cart');
          if (saved) this.cart = JSON.parse(saved);
          this.$watch('cart', v => localStorage.setItem('aa_cart', JSON.stringify(v)));
        },

        brandProductCount(brandName){
          return this.products.filter(p => p.brand === brandName).length;
        },

        passengerBrandModels(brandName){
          const brand = this.passengerBrands.find(b => b.name === brandName);
          return brand ? brand.models : [];
        },

        filteredProducts(){
          return this.products.filter(p => {
            const brandMatch = !this.filters.brand || p.brand === this.filters.brand;
            const q = this.filters.query.trim().toLowerCase();
            const queryMatch = !q || (p.name + ' ' + p.size).toLowerCase().includes(q);
            return brandMatch && queryMatch;
          });
        },

        addToCart(p){
          const existing = this.cart.find(i => i.id === p.id);
          if (existing) existing.qty++;
          else this.cart.push({...p, qty:1});
          this.cartOpen = true;
        },

        subtotal(){
          return this.cart.reduce((sum, i) => sum + i.price * i.qty, 0);
        },

        // send two emails with the standard template (orders/contact/brand inquiries)
        async sendTwoEmails(params){
          await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {...params, to_email: 'Ilimot2012@gmail.com'});
          await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {...params, to_email: params.customer_email || params.from_email});
        },

        // BRAND INQUIRY
        async sendBrandInquiry(brandName){
          const list = this.products.filter(p => p.brand === brandName);
          const lines = list.length
            ? list.map(p => `• ${p.name} (${p.size}) — $${p.price.toFixed(2)}`).join('\n')
            : 'لا توجد منتجات مسجلة لهذه العلامة حتى الآن.';

          const params = {
            subject_line: `استفسار علامة — ${brandName}`,
            from_name: 'زائر الموقع',
            from_email: 'no-reply@aslamalteeba.netlify.app',
            customer_email: 'no-reply@aslamalteeba.netlify.app',
            message: `طلب الزائر معلومات عن ${brandName}.`,
            brand_name: brandName,
            brand_products: lines
          };

          try {
            await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {...params, to_email: 'Ilimot2012@gmail.com'});
            alert('✅ تم إرسال الاستفسار! سيتم التواصل قريباً.');
          } catch (err){
            console.error(err);
            alert('❌ حدث خطأ أثناء إرسال الاستفسار: ' + (err?.text || err?.message || 'غير معروف'));
          }
        },

        // CONTACT
        async sendContact(){
          const params = {
            subject_line: 'تواصل — Aslama Alteeba',
            from_name: this.contact.name,
            from_email: this.contact.email,
            customer_email: this.contact.email,
            message: this.contact.message
          };
          try {
            await this.sendTwoEmails(params);
            alert('✅ تم إرسال الرسالة!');
            this.contact = {name:'',email:'',message:''};
          } catch (err){
            console.error(err);
            alert('❌ حدث خطأ أثناء إرسال الرسالة: ' + (err?.text || err?.message || 'غير معروف'));
          }
        },

        // ORDER
        async placeOrder(){
          if (this.cart.length===0) return;
          const lines = this.cart.map(i => `${i.qty}x ${i.name} (${i.size}) — $${(i.price*i.qty).toFixed(2)}`).join('\n');
          const sub = this.subtotal(), vat=sub*0.05, total=sub+vat;
          const params = {
            subject_line: `طلب — ${this.checkout.name}`,
            from_name: this.checkout.name,
            from_email: this.checkout.email,
            customer_email: this.checkout.email,
            message: 'تم إنشاء طلب جديد عبر الموقع (وضع تجريبي).',
            order_lines: lines,
            order_subtotal: `$${sub.toFixed(2)}`,
            order_vat: `$${vat.toFixed(2)}`,
            order_total: `$${total.toFixed(2)}`,
            customer_phone: this.checkout.phone || 'N/A',
            customer_vehicle: this.checkout.vehicle || 'N/A'
          };
          try {
            await this.sendTwoEmails(params);
            alert('✅ تم إرسال الطلب بنجاح!');
            this.cart = [];
            this.cartOpen = false;
            this.checkout = {name:'',email:'',phone:'',vehicle:''};
          } catch(err){
            console.error(err);
            alert('❌ حدث خطأ أثناء إرسال الطلب: ' + (err?.text || err?.message || 'غير معروف'));
          }
        },

        // INTRO EMAIL (uses dedicated template)
        async sendIntro(){
          this.introSuccess = false; this.introError = '';
          const params = {
            subject_line: 'طلب تعريف — Aslama Alteeba',
            from_name: this.intro.name,
            from_email: this.intro.email,
            customer_email: this.intro.email,
            phone: this.intro.phone
          };
          try {
            await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_INTRO_TEMPLATE, {...params, to_email: 'Ilimot2012@gmail.com'});
            await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_INTRO_TEMPLATE, {...params, to_email: params.customer_email});
            this.introSuccess = true;
            this.intro = {name:'',email:'',phone:''};
          } catch(err){
            console.error(err);
            this.introError = 'خطأ: ' + (err?.text || err?.message || 'غير معروف');
          }
        },

        scrollChat(){
          const el = this.$refs.chatScroll;
          if (el) el.scrollTop = el.scrollHeight;
        },

        async sendChatMessage(){
          const content = this.chatInput.trim();
          if (!content || this.chatLoading) return;
          this.chatError = '';
          this.chatMessages.push({role:'user', content});
          this.chatInput = '';
          this.chatLoading = true;
          this.$nextTick(() => this.scrollChat());
          try {
            const response = await fetch('/api/chat', {
              method: 'POST',
              headers: {'Content-Type':'application/json'},
              body: JSON.stringify({message: content})
            });
            const data = await response.json().catch(() => ({}));
            if (!response.ok) {
              throw new Error(data?.error || data?.message || 'Failed to get AI response');
            }
            const reply = (data?.reply || '').trim() || 'Thanks for your question. The team will follow up soon.';
            this.chatMessages.push({role:'assistant', content: reply});
          } catch(err) {
            const msg = err?.message || 'AI chat is unavailable right now.';
            this.chatError = msg;
            this.chatMessages.push({role:'assistant', content: 'Sorry, the assistant is unavailable right now. Please try again later.'});
          } finally {
            this.chatLoading = false;
            this.$nextTick(() => this.scrollChat());
          }
        }
      }
    }
  </script>
  <script src="/chat.js" defer></script>
</body>
</html>
