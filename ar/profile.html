<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>الحساب - أسلمة الطيبة</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script>
    document.documentElement.classList.add("js-page-transition");
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles/smoothness.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script defer src="/transition.js"></script>
  
  <style>
    html,body{font-family:Tajawal,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
    .glass{backdrop-filter: blur(12px); background: rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1)}
    [x-cloak]{display:none !important}
  </style>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signOut,
      sendPasswordResetEmail
    } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD5vnHsA23Uw3snDvu4qvqSh5wgRtDTMSc",
      authDomain: "aslamalteeba-2.firebaseapp.com",
      projectId: "aslamalteeba-2",
      storageBucket: "aslamalteeba-2.firebasestorage.app",
      messagingSenderId: "1004820564683",
      appId: "1:1004820564683:web:9833a031e3fa62a365e94e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "/auth.html";
      } else {
        document.getElementById("userEmail").textContent = user.email;
      }
    });

    window.signOutUser = async () => {
      await signOut(auth);
      window.location.href = "/ar/";
    };

    window.changePassword = async () => {
      const user = auth.currentUser;
      if (!user) return;
      try {
        await sendPasswordResetEmail(auth, user.email);
        alert("تم إرسال بريد إعادة تعيين كلمة المرور إلى " + user.email);
      } catch (error) {
        alert("خطأ: " + error.message);
      }
    };
  </script>
</head>

<body class="bg-neutral-950 text-neutral-100" x-data="{ activeSection: 'profile' }">
  <div id="page-transition" class="page-transition is-active" aria-hidden="true"></div>
  
  <!-- Header -->
  <header class="glass sticky top-0 z-50">
    <div class="max-w-7xl mx-auto flex items-center justify-between px-4 py-3">
      <h1 class="text-xl font-extrabold tracking-tight">Aslama <span class="text-emerald-400">Alteeba</span></h1>
      <a href="/ar/" class="px-4 py-2 rounded-xl bg-white/10 border border-white/10 hover:bg-white/15">
        العودة إلى المتجر
      </a>
    </div>
  </header>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 py-8">
    <h2 class="text-3xl font-bold mb-8">الحساب</h2>
    
    <div class="grid md:grid-cols-[250px_1fr] gap-6">
      
      <!-- Left Sidebar -->
      <aside class="space-y-2">
        <button 
          @click="activeSection = 'profile'" 
          :class="activeSection === 'profile' ? 'bg-white/15' : 'bg-white/5 hover:bg-white/10'"
          class="w-full text-right px-4 py-3 rounded-xl border border-white/10 transition">
          الملف الشخصي
        </button>
        <button 
          @click="activeSection = 'security'" 
          :class="activeSection === 'security' ? 'bg-white/15' : 'bg-white/5 hover:bg-white/10'"
          class="w-full text-right px-4 py-3 rounded-xl border border-white/10 transition">
          الأمان
        </button>
        <button 
          @click="activeSection = 'email'" 
          :class="activeSection === 'email' ? 'bg-white/15' : 'bg-white/5 hover:bg-white/10'"
          class="w-full text-right px-4 py-3 rounded-xl border border-white/10 transition">
          تفضيلات البريد الإلكتروني
        </button>
        <button 
          @click="activeSection = 'signout'" 
          :class="activeSection === 'signout' ? 'bg-white/15' : 'bg-white/5 hover:bg-white/10'"
          class="w-full text-right px-4 py-3 rounded-xl border border-white/10 transition">
          تسجيل الخروج
        </button>
        
        <div class="pt-4">
          <a href="/ar/" class="block w-full text-center px-4 py-3 rounded-xl bg-emerald-500 text-black font-semibold hover:opacity-90">
            العودة إلى المتجر
          </a>
        </div>
      </aside>

      <!-- Right Panel -->
      <main>
        
        <!-- Profile Section -->
        <div x-show="activeSection === 'profile'" x-cloak>
          <div class="bg-white/5 border border-white/10 rounded-2xl p-6">
            <h3 class="text-xl font-bold mb-4">الملف الشخصي</h3>
            
            <div class="flex items-center gap-4 mb-6">
              <div class="w-20 h-20 rounded-full bg-white/10 border border-white/10 flex items-center justify-center">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="8" r="4"/>
                  <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2"/>
                </svg>
              </div>
              <div>
                <p class="text-sm text-neutral-400">البريد الإلكتروني</p>
                <p id="userEmail" class="text-lg font-semibold">جارٍ التحميل...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Security Section -->
        <div x-show="activeSection === 'security'" x-cloak>
          <div class="bg-white/5 border border-white/10 rounded-2xl p-6">
            <h3 class="text-xl font-bold mb-4">الأمان</h3>
            <p class="text-neutral-300 mb-4">إدارة كلمة المرور وإعدادات الأمان الخاصة بك.</p>
            <button onclick="changePassword()" class="px-6 py-3 rounded-xl bg-emerald-500 text-black font-semibold hover:opacity-90">
              تغيير كلمة المرور
            </button>
          </div>
        </div>

        <!-- Email Preferences Section -->
        <div x-show="activeSection === 'email'" x-cloak>
          <div class="bg-white/5 border border-white/10 rounded-2xl p-6">
            <h3 class="text-xl font-bold mb-4">تفضيلات البريد الإلكتروني</h3>
            <div class="flex items-center justify-between mb-4">
              <div>
                <p class="font-semibold">النشرة الإخبارية</p>
                <p class="text-sm text-neutral-400">تلقي التحديثات حول المنتجات والعروض</p>
              </div>
              <div class="px-3 py-1 bg-neutral-800 text-neutral-400 rounded-lg text-sm">
                قريباً
              </div>
            </div>
          </div>
        </div>

        <!-- Sign Out Section -->
        <div x-show="activeSection === 'signout'" x-cloak>
          <div class="bg-white/5 border border-white/10 rounded-2xl p-6">
            <h3 class="text-xl font-bold mb-4">تسجيل الخروج</h3>
            <p class="text-neutral-300 mb-4">سيتم تسجيل خروجك من حسابك وإعادة توجيهك إلى الصفحة الرئيسية.</p>
            <button onclick="signOutUser()" class="px-6 py-3 rounded-xl bg-red-600 text-white font-semibold hover:opacity-90">
              تسجيل الخروج
            </button>
          </div>
        </div>

      </main>
    </div>
  </div>

</body>
</html>
